!function(){function f(e){return document.createElementNS(o,e)}function p(e){return(10>e?"0":"")+e}function g(e){var t=++m+"";return e?e+t:t}function M(t,o){function N(e,t){var s=a.offset(),c=/^touch/.test(e.type),d=s.left+h,f=s.top+h,p=(c?e.originalEvent.touches[0]:e).pageX-d,m=(c?e.originalEvent.touches[0]:e).pageY-f,g=Math.sqrt(p*p+m*m),y=!1;if(!t||!(v-w>g||g>v+w)){e.preventDefault();var $=setTimeout(function(){n.addClass("clockpicker-moving")},200);i&&a.append(x.canvas),x.setHand(p,m,!t,!0),r.off(u).on(u,function(e){e.preventDefault();var t=/^touch/.test(e.type),r=(t?e.originalEvent.touches[0]:e).pageX-d,n=(t?e.originalEvent.touches[0]:e).pageY-f;(y||r!==p||n!==m)&&(y=!0,x.setHand(r,n,!1,!0))}),r.off(l).on(l,function(e){r.off(l),e.preventDefault();var i=/^touch/.test(e.type),s=(i?e.originalEvent.changedTouches[0]:e).pageX-d,c=(i?e.originalEvent.changedTouches[0]:e).pageY-f;(t||y)&&s===p&&c===m&&x.setHand(s,c),"hours"===x.currentView?x.toggleView("minutes",k/2):o.autoclose&&(x.minutesView.addClass("clockpicker-dial-out"),setTimeout(function(){x.done()},k/2)),a.prepend(W),clearTimeout($),n.removeClass("clockpicker-moving"),r.off(u)})}}var s=e(S),a=s.find(".clockpicker-plate"),d=s.find(".clockpicker-hours"),m=s.find(".clockpicker-minutes"),M=s.find(".clockpicker-am-pm-block"),E="INPUT"===t.prop("tagName"),R=E?t:t.find("input"),D=t.find(".input-group-addon"),x=this;if(this.id=g("cp"),this.element=t,this.options=o,this.isAppended=!1,this.isShown=!1,this.currentView="hours",this.isInput=E,this.input=R,this.addon=D,this.popover=s,this.plate=a,this.hoursView=d,this.minutesView=m,this.amPmBlock=M,this.spanHours=s.find(".clockpicker-span-hours"),this.spanMinutes=s.find(".clockpicker-span-minutes"),this.spanAmPm=s.find(".clockpicker-span-am-pm"),this.amOrPm=o.amOrPm||"PM",a.width($),a.height($),o.twelvehour,!1){var P=['<div class="clockpicker-am-pm-block">','<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-am-button">',"AM</button>",'<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-pm-button">',"PM</button>","</div>"].join("");e(P);e('<button type="button" class="btn btn-sm btn-default clockpicker-button am-button">AM</button>').on("click",function(){x.amOrPm="AM",e(".clockpicker-span-am-pm").empty().append(" AM"),x.update()}).appendTo(this.amPmBlock),e('<button type="button" class="btn btn-sm btn-default clockpicker-button pm-button">PM</button>').on("click",function(){x.amOrPm="PM",e(".clockpicker-span-am-pm").empty().append(" PM"),x.update()}).appendTo(this.amPmBlock)}o.autoclose||e('<button type="button" class="btn btn-sm btn-default btn-block clockpicker-button">'+o.donetext+"</button>").click(e.proxy(this.done,this)).appendTo(s),"top"!==o.placement&&"bottom"!==o.placement||"top"!==o.align&&"bottom"!==o.align||(o.align="left"),"left"!==o.placement&&"right"!==o.placement||"left"!==o.align&&"right"!==o.align||(o.align="top"),s.addClass(o.placement),s.addClass("clockpicker-align-"+o.align),this.spanHours.click(e.proxy(this.toggleView,this,"hours")),this.spanMinutes.click(e.proxy(this.toggleView,this,"minutes")),R.on("focus.clockpicker click.clockpicker",e.proxy(this.show,this)),D.on("click.clockpicker",e.proxy(this.toggle,this));var A,j,C,I,T=e('<div class="clockpicker-tick"></div>');if(o.twelvehour)for(A=1;13>A;A+=1)j=T.clone(),C=A/6*Math.PI,I=v,j.css("font-size","120%"),j.css({left:h+Math.sin(C)*I-w,top:h-Math.cos(C)*I-w}),j.html(0===A?"00":A),d.append(j),j.on(c,N);else for(A=0;24>A;A+=1){j=T.clone(),C=A/6*Math.PI;var O=A>0&&13>A;I=O?y:v,j.css({left:h+Math.sin(C)*I-w,top:h-Math.cos(C)*I-w}),O&&j.css("font-size","120%"),j.html(0===A?"00":A),d.append(j),j.on(c,N)}for(A=0;60>A;A+=5)j=T.clone(),C=A/30*Math.PI,j.css({left:h+Math.sin(C)*v-w,top:h-Math.cos(C)*v-w}),j.css("font-size","120%"),j.html(p(A)),m.append(j),j.on(c,N);if(a.on(c,function(t){0===e(t.target).closest(".clockpicker-tick").length&&N(t,!0)}),i){var W=s.find(".clockpicker-canvas"),B=f("svg");B.setAttribute("class","clockpicker-svg"),B.setAttribute("width",$),B.setAttribute("height",$);var V=f("g");V.setAttribute("transform","translate("+h+","+h+")");var L=f("circle");L.setAttribute("class","clockpicker-canvas-bearing"),L.setAttribute("cx",0),L.setAttribute("cy",0),L.setAttribute("r",2);var z=f("line");z.setAttribute("x1",0),z.setAttribute("y1",0);var F=f("circle");F.setAttribute("class","clockpicker-canvas-bg"),F.setAttribute("r",w);var q=f("circle");q.setAttribute("class","clockpicker-canvas-fg"),q.setAttribute("r",3.5),V.appendChild(z),V.appendChild(F),V.appendChild(q),V.appendChild(L),B.appendChild(V),W.append(B),this.hand=z,this.bg=F,this.fg=q,this.bearing=L,this.g=V,this.canvas=W}b(this.options.init)}function b(e){e&&"function"==typeof e&&e()}var n,e=window.jQuery,t=e(window),r=e(document),o="http://www.w3.org/2000/svg",i="SVGAngle"in window&&function(){var e,t=document.createElement("div");return t.innerHTML="<svg/>",e=(t.firstChild&&t.firstChild.namespaceURI)==o,t.innerHTML="",e}(),s=function(){var e=document.createElement("div").style;return"transition"in e||"WebkitTransition"in e||"MozTransition"in e||"msTransition"in e||"OTransition"in e}(),a="ontouchstart"in window,c="mousedown"+(a?" touchstart":""),u="mousemove.clockpicker"+(a?" touchmove.clockpicker":""),l="mouseup.clockpicker"+(a?" touchend.clockpicker":""),d=navigator.vibrate?"vibrate":navigator.webkitVibrate?"webkitVibrate":null,m=0,h=90,v=70,y=44,w=13,$=2*h,k=s?350:1,S=['<div class="popover clockpicker-popover">','<div class="arrow"></div>','<div class="popover-title">','<span class="clockpicker-span-hours text-primary"></span>'," : ",'<span class="clockpicker-span-minutes"></span>','<span class="clockpicker-span-am-pm"></span>',"</div>",'<div class="popover-content">','<div class="clockpicker-plate">','<div class="clockpicker-canvas"></div>','<div class="clockpicker-dial clockpicker-hours"></div>','<div class="clockpicker-dial clockpicker-minutes clockpicker-dial-out"></div>',"</div>",'<span class="clockpicker-am-pm-block">',"</span>","</div>","</div>"].join("");M.DEFAULTS={"default":"",fromnow:0,placement:"bottom",align:"left",donetext:"完成",autoclose:!1,twelvehour:!1,vibrate:!0},M.prototype.toggle=function(){this[this.isShown?"hide":"show"]()},M.prototype.locate=function(){var e=this.element,t=this.popover,r=e.offset(),n=e.outerWidth(),o=e.outerHeight(),i=this.options.placement,s=this.options.align,a={};switch(t.show(),i){case"bottom":a.top=r.top+o;break;case"right":a.left=r.left+n;break;case"top":a.top=r.top-t.outerHeight();break;case"left":a.left=r.left-t.outerWidth()}switch(s){case"left":a.left=r.left;break;case"right":a.left=r.left+n-t.outerWidth();break;case"top":a.top=r.top;break;case"bottom":a.top=r.top+o-t.outerHeight()}t.css(a)},M.prototype.show=function(o){if(!this.isShown){b(this.options.beforeShow);var i=this;this.isAppended||(n=e(document.body).append(this.popover),t.on("resize.clockpicker"+this.id,function(){i.isShown&&i.locate()}),this.isAppended=!0);var s=((this.input.prop("value")||this.options["default"]||"")+"").split(":");if("now"===s[0]){var a=new Date(+new Date+this.options.fromnow);s=[a.getHours(),a.getMinutes()]}this.hours=+s[0]||0,this.minutes=+s[1]||0,this.spanHours.html(p(this.hours)),this.spanMinutes.html(p(this.minutes)),this.spanAmPm.html(" "+this.amOrPm),this.toggleView("hours"),this.locate(),this.isShown=!0,r.on("click.clockpicker."+this.id+" focusin.clockpicker."+this.id,function(t){var r=e(t.target);0===r.closest(i.popover).length&&0===r.closest(i.addon).length&&0===r.closest(i.input).length&&i.hide()}),r.on("keyup.clockpicker."+this.id,function(e){(27===e.keyCode||13===e.keyCode)&&i.hide()}),b(this.options.afterShow)}},M.prototype.hide=function(){b(this.options.beforeHide),this.isShown=!1,r.off("click.clockpicker."+this.id+" focusin.clockpicker."+this.id),r.off("keyup.clockpicker."+this.id),this.popover.hide(),b(this.options.afterHide)},M.prototype.toggleView=function(t,r){var n=!1;t="hours","minutes"===t&&"visible"===e(this.hoursView).css("visibility")&&(b(this.options.beforeHourSelect),n=!0);var o="hours"===t,i=o?this.hoursView:this.minutesView,s=o?this.minutesView:this.hoursView;this.currentView=t,this.spanHours.toggleClass("text-primary",o),this.spanMinutes.toggleClass("text-primary",!o),s.addClass("clockpicker-dial-out"),i.css("visibility","visible").removeClass("clockpicker-dial-out"),this.resetClock(r),clearTimeout(this.toggleViewTimer),this.toggleViewTimer=setTimeout(function(){s.css("visibility","hidden")},k),b(this.options.afterHourSelect)},M.prototype.resetClock=function(e){var t=this.currentView,r=this[t],n="hours"===t,o=Math.PI/(n?6:30),s=r*o,a=n&&r>0&&13>r?y:v,c=Math.sin(s)*a,u=-Math.cos(s)*a,l=this;i&&e?(l.canvas.addClass("clockpicker-canvas-out"),setTimeout(function(){l.canvas.removeClass("clockpicker-canvas-out"),l.setHand(c,u)},e)):this.setHand(c,u)},M.prototype.setHand=function(t,r,n,o){var g,s=Math.atan2(t,-r),a="hours"===this.currentView,c=Math.PI/(a||n?6:30),u=Math.sqrt(t*t+r*r),l=this.options,f=a&&(v+y)/2>u,m=f?y:v;if(l.twelvehour&&(m=v),0>s&&(s=2*Math.PI+s),g=Math.round(s/c),s=g*c,l.twelvehour?a?0===g&&(g=12):(n&&(g*=5),60===g&&(g=0)):a?(12===g&&(g=0),g=f?0===g?12:g:0===g?0:g+12):(n&&(g*=5),60===g&&(g=0)),this[this.currentView]!==g&&d&&this.options.vibrate&&(this.vibrateTimer||(navigator[d](10),this.vibrateTimer=setTimeout(e.proxy(function(){this.vibrateTimer=null},this),100))),this[this.currentView]=g,this[a?"spanHours":"spanMinutes"].html(p(g)),this.update(),!i)return void this[a?"hoursView":"minutesView"].find(".clockpicker-tick").each(function(){var t=e(this);t.toggleClass("active",g===+t.html())});o||!a&&g%5?(this.g.insertBefore(this.hand,this.bearing),this.g.insertBefore(this.bg,this.fg),this.bg.setAttribute("class","clockpicker-canvas-bg clockpicker-canvas-bg-trans")):(this.g.insertBefore(this.hand,this.bg),this.g.insertBefore(this.fg,this.bg),this.bg.setAttribute("class","clockpicker-canvas-bg"));var h=Math.sin(s)*m,w=-Math.cos(s)*m;this.hand.setAttribute("x2",h),this.hand.setAttribute("y2",w),this.bg.setAttribute("cx",h),this.bg.setAttribute("cy",w),this.fg.setAttribute("cx",h),this.fg.setAttribute("cy",w)},M.prototype.done=function(){b(this.options.beforeDone),this.hide(),this.update(),this.options.autoclose&&this.input.trigger("blur"),b(this.options.afterDone)},M.prototype.update=function(){b(this.options.beforeUpdate),this.hours%12<9&&"AM"===this.amOrPm?this.amOrPm="PM":this.hours%12>=9&&"PM"===this.amOrPm&&(this.amOrPm="AM"),e(".clockpicker-span-am-pm").empty().append(" "+this.amOrPm);var t=this.input.prop("value"),r=p(this.hours)+":"+p(this.minutes);this.options.twelvehour&&(r=r+" "+this.amOrPm),this.input.prop("value",r),r!==t&&(this.input.triggerHandler("change"),this.isInput||this.element.trigger("change")),b(this.options.afterUpdate)},M.prototype.remove=function(){this.element.removeData("clockpicker"),this.input.off("focus.clockpicker click.clockpicker"),this.addon.off("click.clockpicker"),this.isShown&&this.hide(),this.isAppended&&(t.off("resize.clockpicker"+this.id),this.popover.remove())},e.fn.clockpicker=function(t){var r=Array.prototype.slice.call(arguments,1);return this.each(function(){var n=e(this),o=n.data("clockpicker");if(o)"function"==typeof o[t]&&o[t].apply(o,r);else{var i=e.extend({},M.DEFAULTS,n.data(),"object"==typeof t&&t);n.data("clockpicker",new M(n,i))}})}}();
