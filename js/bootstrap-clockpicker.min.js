!function(){function h(e){return document.createElementNS(c,e)}function f(e){return(10>e?"0":"")+e}function m(e){var t=++p+"";return e?e+t:t}function k(t,c){function J(e,t){var o=n.offset(),r=/^touch/.test(e.type),u=o.left+g,h=o.top+g,f=(r?e.originalEvent.touches[0]:e).pageX-u,p=(r?e.originalEvent.touches[0]:e).pageY-h,m=Math.sqrt(f*f+p*p),y=!1;if(!t||!(v-w>m||m>v+w)){e.preventDefault();var $=setTimeout(function(){i.addClass("clockpicker-moving")},200);a&&n.append(O.canvas),O.setHand(f,p,!t,!0),s.off(d).on(d,function(e){e.preventDefault();var t=/^touch/.test(e.type),s=(t?e.originalEvent.touches[0]:e).pageX-u,i=(t?e.originalEvent.touches[0]:e).pageY-h;(y||s!==f||i!==p)&&(y=!0,O.setHand(s,i,!1,!0))}),s.off(l).on(l,function(e){s.off(l),e.preventDefault();var a=/^touch/.test(e.type),o=(a?e.originalEvent.changedTouches[0]:e).pageX-u,r=(a?e.originalEvent.changedTouches[0]:e).pageY-h;(t||y)&&o===f&&r===p&&O.setHand(o,r),"hours"===O.currentView?O.toggleView("minutes",b/2):c.autoclose&&(O.minutesView.addClass("clockpicker-dial-out"),setTimeout(function(){O.done()},b/2)),n.prepend(H),clearTimeout($),i.removeClass("clockpicker-moving"),s.off(d)})}}var o=e(C),n=o.find(".clockpicker-plate"),u=o.find(".clockpicker-hours"),p=o.find(".clockpicker-minutes"),k=o.find(".clockpicker-am-pm-block"),B="INPUT"===t.prop("tagName"),S=B?t:t.find("input"),I=t.find(".input-group-addon"),O=this;if(this.id=m("cp"),this.element=t,this.options=c,this.isAppended=!1,this.isShown=!1,this.currentView="hours",this.isInput=B,this.input=S,this.addon=I,this.popover=o,this.plate=n,this.hoursView=u,this.minutesView=p,this.amPmBlock=k,this.spanHours=o.find(".clockpicker-span-hours"),this.spanMinutes=o.find(".clockpicker-span-minutes"),this.spanAmPm=o.find(".clockpicker-span-am-pm"),this.amOrPm=c.amOrPm||"PM",n.width($),n.height($),c.twelvehour,!1){var x=['<div class="clockpicker-am-pm-block">','<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-am-button">',"AM</button>",'<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-pm-button">',"PM</button>","</div>"].join("");e(x);e('<button type="button" class="btn btn-sm btn-default clockpicker-button am-button">AM</button>').on("click",function(){O.amOrPm="AM",e(".clockpicker-span-am-pm").empty().append(" AM"),O.update()}).appendTo(this.amPmBlock),e('<button type="button" class="btn btn-sm btn-default clockpicker-button pm-button">PM</button>').on("click",function(){O.amOrPm="PM",e(".clockpicker-span-am-pm").empty().append(" PM"),O.update()}).appendTo(this.amPmBlock)}c.autoclose||e('<button type="button" class="btn btn-sm btn-default btn-block clockpicker-button">'+c.donetext+"</button>").click(e.proxy(this.done,this)).appendTo(o),"top"!==c.placement&&"bottom"!==c.placement||"top"!==c.align&&"bottom"!==c.align||(c.align="left"),"left"!==c.placement&&"right"!==c.placement||"left"!==c.align&&"right"!==c.align||(c.align="top"),o.addClass(c.placement),o.addClass("clockpicker-align-"+c.align),this.spanHours.click(e.proxy(this.toggleView,this,"hours")),this.spanMinutes.click(e.proxy(this.toggleView,this,"minutes")),S.on("focus.clockpicker click.clockpicker",e.proxy(this.show,this)),I.on("click.clockpicker",e.proxy(this.toggle,this));var _,D,P,j,M=e('<div class="clockpicker-tick"></div>');if(c.twelvehour)for(_=1;13>_;_+=1)D=M.clone(),P=_/6*Math.PI,j=v,D.css("font-size","120%"),D.css({left:g+Math.sin(P)*j-w,top:g-Math.cos(P)*j-w}),D.html(0===_?"00":_),u.append(D),D.on(r,J);else for(_=0;24>_;_+=1){D=M.clone(),P=_/6*Math.PI;var N=_>0&&13>_;j=N?y:v,D.css({left:g+Math.sin(P)*j-w,top:g-Math.cos(P)*j-w}),N&&D.css("font-size","120%"),D.html(0===_?"00":_),u.append(D),D.on(r,J)}for(_=0;60>_;_+=5)D=M.clone(),P=_/30*Math.PI,D.css({left:g+Math.sin(P)*v-w,top:g-Math.cos(P)*v-w}),D.css("font-size","120%"),D.html(f(_)),p.append(D),D.on(r,J);if(n.on(r,function(t){0===e(t.target).closest(".clockpicker-tick").length&&J(t,!0)}),a){var H=o.find(".clockpicker-canvas"),A=h("svg");A.setAttribute("class","clockpicker-svg"),A.setAttribute("width",$),A.setAttribute("height",$);var W=h("g");W.setAttribute("transform","translate("+g+","+g+")");var q=h("circle");q.setAttribute("class","clockpicker-canvas-bearing"),q.setAttribute("cx",0),q.setAttribute("cy",0),q.setAttribute("r",2);var Q=h("line");Q.setAttribute("x1",0),Q.setAttribute("y1",0);var F=h("circle");F.setAttribute("class","clockpicker-canvas-bg"),F.setAttribute("r",w);var G=h("circle");G.setAttribute("class","clockpicker-canvas-fg"),G.setAttribute("r",3.5),W.appendChild(Q),W.appendChild(F),W.appendChild(G),W.appendChild(q),A.appendChild(W),H.append(A),this.hand=Q,this.bg=F,this.fg=G,this.bearing=q,this.g=W,this.canvas=H}L(this.options.init)}function L(e){e&&"function"==typeof e&&e()}var i,e=window.jQuery,t=e(window),s=e(document),c="http://www.w3.org/2000/svg",a="SVGAngle"in window&&function(){var e,t=document.createElement("div");return t.innerHTML="<svg/>",e=(t.firstChild&&t.firstChild.namespaceURI)==c,t.innerHTML="",e}(),o=function(){var e=document.createElement("div").style;return"transition"in e||"WebkitTransition"in e||"MozTransition"in e||"msTransition"in e||"OTransition"in e}(),n="ontouchstart"in window,r="mousedown"+(n?" touchstart":""),d="mousemove.clockpicker"+(n?" touchmove.clockpicker":""),l="mouseup.clockpicker"+(n?" touchend.clockpicker":""),u=navigator.vibrate?"vibrate":navigator.webkitVibrate?"webkitVibrate":null,p=0,g=90,v=70,y=44,w=13,$=2*g,b=o?350:1,C=['<div class="popover clockpicker-popover">','<div class="arrow"></div>','<div class="popover-title">','<span class="clockpicker-span-hours text-primary"></span>'," : ",'<span class="clockpicker-span-minutes"></span>','<span class="clockpicker-span-am-pm"></span>',"</div>",'<div class="popover-content">','<div class="clockpicker-plate">','<div class="clockpicker-canvas"></div>','<div class="clockpicker-dial clockpicker-hours"></div>','<div class="clockpicker-dial clockpicker-minutes clockpicker-dial-out"></div>',"</div>",'<span class="clockpicker-am-pm-block">',"</span>","</div>","</div>"].join("");k.DEFAULTS={"default":"",fromnow:0,placement:"bottom",align:"left",donetext:"完成",autoclose:!1,twelvehour:!1,vibrate:!0},k.prototype.toggle=function(){this[this.isShown?"hide":"show"]()},k.prototype.locate=function(){var e=this.element,t=this.popover,s=e.offset(),i=e.outerWidth(),c=e.outerHeight(),a=this.options.placement,o=this.options.align,n={};switch(t.show(),a){case"bottom":n.top=s.top+c;break;case"right":n.left=s.left+i;break;case"top":n.top=s.top-t.outerHeight();break;case"left":n.left=s.left-t.outerWidth()}switch(o){case"left":n.left=s.left;break;case"right":n.left=s.left+i-t.outerWidth();break;case"top":n.top=s.top;break;case"bottom":n.top=s.top+c-t.outerHeight()}t.css(n)},k.prototype.show=function(c){if(!this.isShown){L(this.options.beforeShow);var a=this;this.isAppended||(i=e(document.body).append(this.popover),t.on("resize.clockpicker"+this.id,function(){a.isShown&&a.locate()}),this.isAppended=!0);var o=((this.input.prop("value")||this.options["default"]||"")+"").split(":");if("now"===o[0]){var n=new Date(+new Date+this.options.fromnow);o=[n.getHours(),n.getMinutes()]}this.hours=+o[0]||0,this.minutes=+o[1]||0,this.spanHours.html(f(this.hours)),this.spanMinutes.html(f(this.minutes)),this.spanAmPm.html(" "+this.amOrPm),this.toggleView("hours"),this.locate(),this.isShown=!0,s.on("click.clockpicker."+this.id+" focusin.clockpicker."+this.id,function(t){var s=e(t.target);0===s.closest(a.popover).length&&0===s.closest(a.addon).length&&0===s.closest(a.input).length&&a.hide()}),s.on("keyup.clockpicker."+this.id,function(e){(27===e.keyCode||13===e.keyCode)&&a.hide()}),L(this.options.afterShow)}},k.prototype.hide=function(){L(this.options.beforeHide),this.isShown=!1,s.off("click.clockpicker."+this.id+" focusin.clockpicker."+this.id),s.off("keyup.clockpicker."+this.id),this.popover.hide(),L(this.options.afterHide)},k.prototype.toggleView=function(t,s){var i=!1;t="hours","minutes"===t&&"visible"===e(this.hoursView).css("visibility")&&(L(this.options.beforeHourSelect),i=!0);var c="hours"===t,a=c?this.hoursView:this.minutesView,o=c?this.minutesView:this.hoursView;this.currentView=t,this.spanHours.toggleClass("text-primary",c),this.spanMinutes.toggleClass("text-primary",!c),o.addClass("clockpicker-dial-out"),a.css("visibility","visible").removeClass("clockpicker-dial-out"),this.resetClock(s),clearTimeout(this.toggleViewTimer),this.toggleViewTimer=setTimeout(function(){o.css("visibility","hidden")},b),L(this.options.afterHourSelect)},k.prototype.resetClock=function(e){var t=this.currentView,s=this[t],i="hours"===t,c=Math.PI/(i?6:30),o=s*c,n=i&&s>0&&13>s?y:v,r=Math.sin(o)*n,d=-Math.cos(o)*n,l=this;a&&e?(l.canvas.addClass("clockpicker-canvas-out"),setTimeout(function(){l.canvas.removeClass("clockpicker-canvas-out"),l.setHand(r,d)},e)):this.setHand(r,d)},k.prototype.setHand=function(t,s,i,c){var m,o=Math.atan2(t,-s),n="hours"===this.currentView,r=Math.PI/(n||i?6:30),d=Math.sqrt(t*t+s*s),l=this.options,h=n&&(v+y)/2>d,p=h?y:v;if(l.twelvehour&&(p=v),0>o&&(o=2*Math.PI+o),m=Math.round(o/r),o=m*r,l.twelvehour?n?0===m&&(m=12):(i&&(m*=5),60===m&&(m=0)):n?(12===m&&(m=0),m=h?0===m?12:m:0===m?0:m+12):(i&&(m*=5),60===m&&(m=0)),this[this.currentView]!==m&&u&&this.options.vibrate&&(this.vibrateTimer||(navigator[u](10),this.vibrateTimer=setTimeout(e.proxy(function(){this.vibrateTimer=null},this),100))),this[this.currentView]=m,this[n?"spanHours":"spanMinutes"].html(f(m)),this.update(),!a)return void this[n?"hoursView":"minutesView"].find(".clockpicker-tick").each(function(){var t=e(this);t.toggleClass("active",m===+t.html())});c||!n&&m%5?(this.g.insertBefore(this.hand,this.bearing),this.g.insertBefore(this.bg,this.fg),this.bg.setAttribute("class","clockpicker-canvas-bg clockpicker-canvas-bg-trans")):(this.g.insertBefore(this.hand,this.bg),this.g.insertBefore(this.fg,this.bg),this.bg.setAttribute("class","clockpicker-canvas-bg"));var g=Math.sin(o)*p,w=-Math.cos(o)*p;this.hand.setAttribute("x2",g),this.hand.setAttribute("y2",w),this.bg.setAttribute("cx",g),this.bg.setAttribute("cy",w),this.fg.setAttribute("cx",g),this.fg.setAttribute("cy",w)},k.prototype.done=function(){L(this.options.beforeDone),this.hide(),this.update(),this.options.autoclose&&this.input.trigger("blur"),L(this.options.afterDone)},k.prototype.update=function(){L(this.options.beforeUpdate),this.options.breakHour&&(this.hours%12<this.options.breakHour&&"AM"===this.amOrPm?this.amOrPm="PM":this.hours%12>=this.options.breakHour&&"PM"===this.amOrPm&&(this.amOrPm="AM")),e(".clockpicker-span-am-pm").empty().append(" "+this.amOrPm);var t=this.input.prop("value"),s=f(this.hours)+":"+f(this.minutes);this.options.twelvehour&&(s=s+" "+this.amOrPm),this.input.prop("value",s),s!==t&&(this.input.triggerHandler("change"),this.isInput||this.element.trigger("change")),L(this.options.afterUpdate)},k.prototype.remove=function(){this.element.removeData("clockpicker"),this.input.off("focus.clockpicker click.clockpicker"),this.addon.off("click.clockpicker"),this.isShown&&this.hide(),this.isAppended&&(t.off("resize.clockpicker"+this.id),this.popover.remove())},e.fn.clockpicker=function(t){var s=Array.prototype.slice.call(arguments,1);return this.each(function(){var i=e(this),c=i.data("clockpicker");if(c)"function"==typeof c[t]&&c[t].apply(c,s);else{var a=e.extend({},k.DEFAULTS,i.data(),"object"==typeof t&&t);i.data("clockpicker",new k(i,a))}})}}();
