function init_typeahead(){"use strict";for(var e=function(e){return function(t,s){var o,i=[],c=[],a=courseList;for(t=t.toLowerCase(),o=0;o<e.length;o+=1){var n=e[o];if(!(a.indexOf(n)>=0)){var r=n+" - "+timetableData[n][0],d=r.toLowerCase().indexOf(t);d>0?i.push(r):0===d&&c.push(r)}}c.sort(),c.length<10&&i.length>0&&(i.sort(),c=c.concat(i)),s(c.slice(0,10))}};void 0===$().typeahead;);$(".typeahead.coursein").typeahead({name:"courses",source:e(Object.keys(timetableData))})}function restoreState(e){"use strict";var i,t=Cookies.getJSON("options"),s=Cookies.getJSON("courses");if(classLocations=Cookies.getJSON("classLocations"),void 0!==t){for(i=0;i<s.length;i+=1)"CBS"!==s[i]&&addCourse(s[i]+" - "+timetableData[s[i]][0]);document.getElementById("tbt").checked=t.cbs.tbt,document.getElementById("bib").checked=t.cbs.bib,document.getElementById("ctr").checked=t.cbs.ctr,document.getElementById("cth").checked=t.cbs.cth,document.getElementById("showcap").checked=t.showcap,document.getElementById("fullclasses").checked=t.fullclasses,document.getElementById("showloc").checked=t.showloc,document.getElementById("canclash").checked=t.canclash,"{}"!==JSON.stringify(classLocations)&&generate(!0,!0)}}function saveState(){"use strict";if(finishedInit){Cookies.set("courses",courseList,{expires:182});var e={cbs:{}};e.cbs.tbt=document.getElementById("tbt").checked,e.cbs.bib=document.getElementById("bib").checked,e.cbs.ctr=document.getElementById("ctr").checked,e.cbs.cth=document.getElementById("cth").checked,e.showcap=document.getElementById("showcap").checked,e.fullclasses=document.getElementById("fullclasses").checked,e.showloc=document.getElementById("showloc").checked,e.canclash=document.getElementById("canclash").checked,Cookies.set("options",e,{expires:182}),Cookies.set("classLocations",classLocations,{expires:182})}}function removeCourse(e){"use strict";var t=$(e.currentTarget).parents("div.row"),s=t.parent(),i=t.children().first(),c=i.html().replace(/ -.+/,""),a=courseList.indexOf(c);-1!==a&&courseList.splice(a,1),t.children().fadeOut(200,function(){t.children().show().css("visibility","hidden"),s.slideUp(200,function(){s.remove(),0===$("#courses").children().length&&$("#courses").css("margin-bottom","-10px")})}),saveState()}function addCourse(e){"use strict";courseList.push(e.replace(/ -.*/,""));var t=$("#courses"),s=$("<span>").addClass("glyphicon glyphicon-remove-circle remove-icon").attr("aria-hidden",!0).click(removeCourse),i=$("<div>").append($("<div>").addClass("row").html('<div class="col-10">'+e+"</div>").append($("<div>").addClass("col-2").css("text-align","right").append(s)));t.append(i).css("margin-bottom",0),i.children().hide(),i.hide().slideDown(200,function(){i.children().fadeIn(200)}),saveState()}function timetableToPNG(){"use strict";var e=document.getElementById("timetable");$(e).width();$(e).removeClass("scroll-x"),$(e).width(720),domtoimage.toPng(e).then(function(t){$(e).addClass("scroll-x"),$(e).css("width","auto"),download(t,"timetable.png","image/png")})}function hasClass(e,t){"use strict";var s=" "+e.className+" ";return-1!==s.indexOf(" "+t+" ")}function createTable(){"use strict";var d,l,u,h,e=$("#timetable").find(".row"),t='<div class="col col-1 head first"></div><div class="col head">Monday</div><div class="col head">Tuesday</div><div class="col head">Wednesday</div><div class="col head">Thursday</div><div class="col head">Friday</div>',s="",i='<div class="w-100"></div>',c=8,a=21,o=function(e,t){return t=t===!0?"half":"small",'<div class="col col-1 body first '+t+'" id="ttrow_'+e+'">'+("small"===t?"<div>"+e+":00</div>":"")+"</div>"},n=function(e,t,s){return s=s===!0?" half":"",'<div class="col body'+s+'" id="'+t+"_"+e+'"></div>'},r=["M","T","W","H","F"];for(d=0;2*(a-c)>d;d+=1){for(l=c+Math.floor(d/2),h=d%2===1,s+=o(l,h),u=0;u<r.length;u+=1)s+=n(l,r[u],h);d!==2*(a-c)-1&&(s+=i)}e.html(t+i+s)}function showEmpty(){"use strict";$("#timetable").find(".body:hidden").show()}function hideEmpty(e,t){"use strict";var s=$(".class-shadow"),i=$("#timetable").find(".body"),c=$();e=e||1/0,t=t||-(1/0),e===1/0&&s.each(function(s,i){var c=$(i).parent().position().top;e=Math.min(e,c),t=Math.max(t,c+$(i).height())}),e!==1/0&&(i.filter('[id^="M"]').not('[id$="_30"]').each(function(s,a){var n,o=$(a).position().top;(e>o||o>=t)&&(n=a.getAttribute("id").replace(/[^_\d]/g,""),c=c.add(i.filter('[id$="'+n+'"]')),c=c.add(i.filter('[id$="'+n+'_30"]')))}),c.hide())}function getColour(e){"use strict";var t=[[19,111,225],[160,29,33],[0,140,72],[102,44,145],[255,107,0],[10,28,210],[238,46,20]];return t[e%t.length].join(",")}function startDrag(e,t){"use strict";var s=$(e.target),i=s.attr("id"),c=shadowList[i];c.fadeIn(200)}function stopDrag(e,t){"use strict";function s(e,t){e.detach().appendTo(t).css({left:0,top:0})}var o,n,i=$(e.target),c=i.width()/2*i.width()/2,a=null;$(".class-shadow:visible").each(function(){var e=$(this).offset(),t=i.offset(),s=Math.pow(e.left-t.left,2)+Math.pow(e.top-t.top,2);c>s&&(c=s,a=$(this))}),null!==a&&(o=i.attr("id"),n=shadowList[o].index(a),$('.class-drag[id^="'+o.replace(/\d$/,"")+'"]').each(function(){var e=$(this),t=$(shadowList[e.attr("id")][n]);s(e,t.parent()),e.find(".class-capacity").html(t.data("capacity")),classLocations[e.attr("id")]=t.parent().attr("id"),saveState()})),$(".class-shadow").fadeOut(200)}function unique(e,t){"use strict";var a,s=[],i=[],c=[];for(a=0;a<e.length;a+=1)-1===c.indexOf(String(e[a]))&&(s.push(e[a]),c.push(String(e[a])),void 0!==t&&i.push(t[a]));for(a=0;a<s.length;a+=1)e[a]=s[a],void 0!==t&&(t[a]=i[a]);for(;a<e.length;)e.pop(),void 0!==t&&t.pop()}function createClassDiv(e,t,s,i,c,a,o){"use strict";return $("<div>").html("<div>"+e+t+s+"</div>").draggable({stack:".class-drag",scroll:!0,containment:o,start:startDrag,stop:stopDrag}).css({position:"absolute","background-color":"rgb("+getColour(c)+")",height:ttCellHeight*a}).attr("id",i).addClass("class-drag")}function createClass(e,t,s){"use strict";var r,d,l,u,h,f,p,m,i=e.time,c=e.enrols,a=e.course,o=e.component,n=e.location,g='<div style="font-weight: bold">'+("CBS"!==a?a+": "+o:o)+"</div>",v=0,y=$("#timetable").find(".row");for(c="CBS"!==a?'<div class="class-capacity">'+c.replace(","," / ")+"</div>":'<div class="class-capacity"></div>',l=0;l<i.length;l+=1)r=i[l],d='<div class="class-location">'+n[l]+"</div>",-1===s.indexOf(r.join(",")+a+o)?(s.push(r.join(",")+a+o),u=a+o+(l-v),h=r[2]-r[1],f=(r[0]+"_"+r[1]).replace(".5","_30"),p=$("#"+f),m=createClassDiv(g,d,c,u,t,h,y),m.appendTo(p),classList.push(m),classLocations.hasOwnProperty(u)||(classLocations[u]=f)):v+=1;document.getElementById("showcap").checked||$(".class-capacity").hide(),document.getElementById("showloc").checked||$(".class-location").hide()}function createShadow(e,t,s){"use strict";var i,c,a,o,n,r,d,l,f,p,m,g,v,y,w,b,C;for(i=e.time,c=e.course+e.component,a=e.enrols,o=e.location,w=1/0,b=-(1/0),0===c.indexOf("CBS")&&(a=""),unique(i,o),l=0;l<i.length;l+=1)r=i[l],d=r.join(","),n=o[l],v=c+l,s.hasOwnProperty(c)?s[c].push(d):s[c]=[d],g=r[2]-r[1],C=ttCellHeight*g,m=(r[0]+"_"+r[1]).replace(".5","_30"),p=$("#"+m),f=$("<div>").css({"background-color":"rgba("+getColour(t)+", 0.7)",height:C}).addClass("class-shadow"),f.data("capacity",a.replace(","," / ")),f.data("location",n.replace(","," / ")),f.appendTo(p),shadowList.hasOwnProperty(v)?shadowList[v]=shadowList[v].push(f):shadowList[v]=f,y=p.position().top,w=Math.min(w,-1===m.indexOf("_30")?y:y-ttCellHeight),b=Math.max(b,y+C);return{min:w,max:b}}function restoreClasses(){"use strict";function e(e,t){e.detach().appendTo(t).css({position:"absolute",left:0,top:0})}var t,s,i,c,a;for(t in classLocations)classLocations.hasOwnProperty(t)&&(s=$('[id="'+t+'"]'),i=shadowList[t],c=$("#"+classLocations[t]),a=c.find(i),e(s,c),s.find(".class-capacity").html(a.data("capacity")))}function clearLists(e){"use strict";classList=[],shadowList={},e!==!0&&(classLocations={})}var finishedInit=!1,courseList=["CBS"],classList=[],shadowList={},classLocations={},ttCellHeight=50,waitingScripts=0,timetableData={};$.fn.push=function(e){"use strict";return Array.prototype.push.apply(this,$.makeArray($(e))),this},function(){"use strict";$(document).ready(function(){$("#showcap").change(function(){var e=$(".class-capacity");document.getElementById("showcap").checked===!0?e.show():e.hide()}),$("#showloc").change(function(){var e=$(".class-location");document.getElementById("showloc").checked===!0?e.show():e.hide()}),$(".savedOption").change(function(){saveState()}),$("#saveimage").click(function(){timetableToPNG()})}),$.getJSON("data/timetable.json",function(e){timetableData=e,$(document).ready(function(){init_typeahead(),createTable(),restoreState(e),finishedInit=!0})})}();
