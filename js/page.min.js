function init_typeahead(){"use strict";for(var e=function(e){return function(t,n){var i,s=[],a=[],o=courseList;for(t=t.toLowerCase(),i=0;i<e.length;i+=1){var r=e[i];if(!(o.indexOf(r)>=0)){var c=r+" - "+timetableData[r][0],l=c.toLowerCase().indexOf(t);l>0?s.push(c):0===l&&a.push(c)}}a.sort(),a.length<10&&s.length>0&&(s.sort(),a=a.concat(s)),n(a.slice(0,10))}};void 0===$().typeahead;);$(".typeahead.coursein").typeahead({name:"courses",source:e(Object.keys(timetableData))})}function restoreState(e){"use strict";var s,t=Cookies.getJSON("options"),n=Cookies.getJSON("courses")||[];if(classLocations=Cookies.getJSON("classLocations")||{},customClasses=Cookies.getJSON("custom")||[],void 0!==t){for(s=0;s<n.length;s+=1)"CBS"!==n[s]&&timetableData.hasOwnProperty(n[s])&&addCourse(n[s]+" - "+timetableData[n[s]][0],!1,!1);for(s=0;s<customClasses.length;s+=1){var a=addCourse(customClasses[s].component,!0,!1);a.data("custom",customClasses[s].course)}document.getElementById("tbt").checked=t.cbs.tbt,document.getElementById("bib").checked=t.cbs.bib,document.getElementById("ctr").checked=t.cbs.ctr,document.getElementById("cth").checked=t.cbs.cth,document.getElementById("showcap").checked=t.showcap,document.getElementById("fullclasses").checked=t.fullclasses,document.getElementById("showloc").checked=t.showloc,document.getElementById("canclash").checked=t.canclash,"{}"!==JSON.stringify(classLocations)&&generate(!0,!0)}}function saveState(e){"use strict";if(finishedInit){Cookies.set("courses",courseList,{expires:182}),Cookies.set("custom",customClasses,{expires:182});var t={cbs:{}};t.cbs.tbt=document.getElementById("tbt").checked,t.cbs.bib=document.getElementById("bib").checked,t.cbs.ctr=document.getElementById("ctr").checked,t.cbs.cth=document.getElementById("cth").checked,t.fullclasses=optionMemory.fullclasses,t.canclash=optionMemory.canclash,t.showcap=document.getElementById("showcap").checked,t.showloc=document.getElementById("showloc").checked,Cookies.set("options",t,{expires:182}),Cookies.set("classLocations",classLocations,{expires:182})}}function removeCourse(e){"use strict";var t=$(e.currentTarget).parents(".course"),n=t.children().first(),s=n.html().replace(/ -.+/,"");if(t.data("custom")!==!1){for(var a=0;a<customClasses.length;a+=1)if(customClasses[a].course===t.data("custom")){customClasses.splice(a,1);break}}else-1!==courseList.indexOf(s)&&courseList.splice(courseList.indexOf(s),1);t.children().fadeOut(200,function(){t.children().show().css("visibility","hidden"),t.slideUp(200,function(){t.remove(),0===$("#courses").children().length&&$("#courses").css("margin-bottom","-10px")})}),saveState()}function addCourse(e,t,n){"use strict";t!==!0&&courseList.push(e.replace(/ -.*/,""));var s=$("#courses"),a=$("<span>").addClass("glyphicon glyphicon-remove-circle glyphicon-clickable remove-icon").attr("aria-hidden",!0).attr("data-toggle","tooltip").attr("title","Remove").click(removeCourse),o=$("<span>").addClass("glyphicon glyphicon-edit glyphicon-clickable edit-icon").attr("data-toggle","tooltip").attr("title","Edit").attr("aria-hidden",!0).attr("data-toggle","modal").attr("data-target","#customClass").click(showEdit),i=$("<div>").append(a),r=t!==!0?i:i.prepend(o),c=$('<div class="course">').html("<div>"+e+"</div>").append(r).data("custom",!1);return s.append(c).css("margin-bottom",0),n!==!1&&(c.children().hide(),c.hide().slideDown(200,function(){c.children().fadeIn(200)})),saveState(),c}function to24H(e){if(void 0===e||0===e.length)return void 0;var t=parseInt(e.replace(/\D.*/,""))%12;return t+(-1!==e.indexOf("PM")?12:0)}function to12H(e){if(void 0===e||""===e)return void 0;var t=e%12===0?12:e%12,n=(10>t?"0"+t:t)+":00 "+(e>=12?"PM":"AM");return n}function getRandomInt(e,t){return e=Math.ceil(e||0),t=Math.floor(t||1e6),Math.floor(Math.random()*(t-e))+e}function uniqueID(){var t,e="custom"+getRandomInt()+"_";for(t=0;t<customClasses.length;t+=1)if(customClasses[t].course===e)return uniqueID();return e}function addCustom(){"use strict";for(var e=document.getElementById("customTitle").value,t=document.getElementById("customLocation").value,n=to24H(document.getElementById("startTime").value),s=to24H(document.getElementById("endTime").value),a=$('input[type="radio"][name="customDay"]').parent(".active").data("day"),o=a+" "+n+(s-n!==1?"-"+s:""),i=document.getElementById("customID").value||uniqueID(),r=getComputedStyle(document.querySelector('input[type="radio"][name="customColour"]:checked'),":before").getPropertyValue("background-color").replace(/rgba\(|, 0\.85\)/g,""),c={time:o,status:"O",enrols:"0,1",course:i,component:e,location:[t],colour:r},l=0;l<customClasses.length;l+=1)if(customClasses[l].course===i){customClasses.splice(l,1);break}customClasses.push(c);var d;"Edit"===document.getElementById("addcustom").innerHTML?($("#courses").children().filter(function(e,t){return $(t).data("custom")===i}).remove(),d=addCourse(e,!0,!1)):d=addCourse(e,!0),d.data("custom",i)}function showEdit(e){"use strict";for(var a,t=$(e.target).parents(".course"),n=t.children().first().html(),s=t.data("custom"),o=0;o<customClasses.length;o+=1)if(customClasses[o].course===s){a=customClasses[o];break}var i=a.time.replace(/.* /,"").split("-"),r=a.time.replace(/ .*/,"");1===i.length&&(i[1]=+i[0]+1),document.getElementById("customID").value=s,document.getElementById("addcustom").innerHTML="Edit",document.getElementById("customTitle").value=n,document.getElementById("customLocation").value=a.location,document.getElementById("startTime").value=to12H(i[0]),document.getElementById("endTime").value=to12H(i[1]),$('input[type="radio"][name="customColour"]').attr("checked",!1).each(function(e,t){return getComputedStyle(t,":before").getPropertyValue("background-color").replace(/rgba\(|, 0\.85\)/g,"")===a.colour?($(t).attr("checked",!0),!1):void 0}),$('input[type="radio"][name="customDay"]').parent().removeClass("active"),$('input[type="radio"][name="customDay"]').parent('[data-day="'+r+'"]').addClass("active"),checkFields()}function timetableToPNG(){"use strict";var e=document.getElementById("timetable");$(e).width();$(e).removeClass("scroll-x"),$(e).width(720),domtoimage.toPng(e).then(function(t){$(e).addClass("scroll-x"),$(e).css("width","auto"),download(t,"timetable.png","image/png")})}function hasClass(e,t){"use strict";var n=" "+e.className+" ";return-1!==n.indexOf(" "+t+" ")}function createTable(){"use strict";var l,d,u,f,e=$("#timetable").find(".row"),t='<div class="col col-1 head first"></div><div class="col head">Monday</div><div class="col head">Tuesday</div><div class="col head">Wednesday</div><div class="col head">Thursday</div><div class="col head">Friday</div>',n="",s='<div class="w-100"></div>',a=8,o=21,i=function(e,t){var n="small",s=e;return e+=":00",t===!0&&(s+="_30",e="",n="half"),'<div class="col col-1 body first '+n+'" id="ttrow_'+s+'">'+(t?"":"<div>"+e.replace("_",":")+"</div>")+"</div>"},r=function(e,t,n){var s="";return n===!0&&(e+="_30",s=" half"),'<div class="col body'+s+'" id="'+t+"_"+e+'"></div>'},c=["M","T","W","H","F"];for(l=0;2*(o-a)>l;l+=1){for(d=a+Math.floor(l/2),f=l%2===1,n+=i(d,f),u=0;u<c.length;u+=1)n+=r(d,c[u],f);l!==2*(o-a)-1&&(n+=s)}e.html(t+s+n)}function showEmpty(){"use strict";$("#timetable").find(".body").css("display","block")}function hideEmpty(e,t){"use strict";var a,n=$("#timetable").find(".body");n.find(".class-shadow");for(a=0;a<n.length;a+=1){var o=n[a],i=ttHeadHeight+ttCellHeight*(+o.id.replace(/\D+_/,"").replace("_30","")+1);(e>i||i>t)&&(o.style.display="none")}}function clearWarning(){document.getElementById("generateWarning");optionMemory.fullclasses=document.getElementById("fullclasses").checked,optionMemory.canclash=document.getElementById("canclash").checked,updateWarning()}function updateWarning(){var e=document.getElementById("generateWarning");document.getElementById("fullclasses").checked!==optionMemory.fullclasses||document.getElementById("canclash").checked!==optionMemory.canclash?(e.innerHTML="Some options have not yet taken effect. Please generate a new timetable to include these options.",e.style.display="block"):(e.innerHTML="",e.style.display="none")}function getColour(e){"use strict";var t=[[19,111,225],[160,29,33],[14,147,40],[102,44,145],[255,107,0],[10,28,210],[238,46,20],[27,98,46]];return t[e%t.length].join(",")}function startDrag(e,t){"use strict";var n=$(e.target),s=n.attr("id"),a=shadowList[s];a.fadeIn(200)}function stopDrag(e,t){"use strict";function n(e,t){e.detach().appendTo(t).css({left:0,top:0})}var i,r,s=$(e.target),a=s.width()/2*s.width()/2,o=null;$(".class-shadow:visible").each(function(){var e=$(this).offset(),t=s.offset(),n=Math.pow(e.left-t.left,2)+Math.pow(e.top-t.top,2);a>n&&(a=n,o=$(this))}),null!==o&&(i=s.attr("id"),r=shadowList[i].index(o),$('.class-drag[id^="'+i.replace(/\d$/,"")+'"]').each(function(){var e=$(this),t=$(shadowList[e.attr("id")][r]);n(e,t.parent()),e.find(".class-capacity").html(t.data("capacity")),e.find(".class-location").html(t.data("location")),classLocations[e.attr("id")]=t.parent().attr("id")})),$(".class-shadow").fadeOut(200),saveState()}function unique(e,t){"use strict";var o,n=[],s=[],a=[];for(o=0;o<e.length;o+=1)-1===a.indexOf(String(e[o]))&&(n.push(e[o]),a.push(String(e[o])),void 0!==t&&s.push(t[o]));for(o=0;o<n.length;o+=1)e[o]=n[o],void 0!==t&&(t[o]=s[o]);for(;o<e.length;)e.pop(),void 0!==t&&t.pop()}function createClassDiv(e,t,n,s,a,o,i){"use strict";var r=$("<div>").attr("id",s).addClass("class-drag").draggable({stack:".class-drag",scroll:!0,containment:i,start:startDrag,stop:stopDrag}),c=r[0];return c.innerHTML="<div>"+e+t+n+"</div>",c.style.position="absolute",c.style.backgroundColor="rgb("+a+")",c.style.height=ttCellHeight*o+"px",r}function createClass(e,t,n){"use strict";var l,d,u,f,m,h,g,p,s=e.time,a=e.enrols,o=e.course,i=e.component,r=e.location,c=e.colour||getColour(t),v='<div style="font-weight: bold">'+(0!==o.indexOf("custom")&&"CBS"!==o?o+": "+i:i)+"</div>",y=0,b=$("#timetable").find(".row");for(a=0!==o.indexOf("custom")&&"CBS"!==o?'<div class="class-capacity">'+a.replace(","," / ")+"</div>":"",u=0;u<s.length;u+=1){l=s[u],d='<div class="class-location">'+r[u]+"</div>";var C=l.join(",")+o+i;-1===n.indexOf(C)?(n.push(C),f=o+i+"_"+(u-y),m=l[2]-l[1],h=(l[0]+"_"+l[1]).replace(".5","_30"),g=$("#"+h),p=createClassDiv(v,d,a,f,c,m,b),p.appendTo(g),classList.push(p),classLocations.hasOwnProperty(f)||(classLocations[f]=h)):y+=1}document.getElementById("showcap").checked||$(".class-capacity").hide(),document.getElementById("showloc").checked||$(".class-location").hide()}function createShadow(e,t){"use strict";var n=e.time,s=e.course+e.component+"_",a=e.enrols,o=e.location,i=e.colour||getColour(t),r=1/0,c=-(1/0);(0===s.indexOf("CBS")||0===e.course.indexOf("custom"))&&(a=""),unique(n,o);var l;for(l=0;l<n.length;l+=1){var b,d=n[l],f=(d.join(","),o[l]),m=s+l,h=d[2]-d[1],g=ttCellHeight*h,p=(d[0]+"_"+d[1]).replace(".5","_30"),v=$("#"+p),y=ttHeadHeight+d[1]*ttCellHeight;b=$('<div class="class-shadow">'),b[0].style.backgroundColor="rgba("+i+", 0.7)",b[0].style.height=g+"px",b.data("capacity",a.replace(","," / ")),b.data("location",f.replace(","," / ")),b.appendTo(v),shadowList.hasOwnProperty(m)?shadowList[m]=shadowList[m].push(b):shadowList[m]=b,r=Math.min(r,-1===p.indexOf("_30")?y:y-ttCellHeight),c=Math.max(c,y+g)}return{min:r,max:c}}function restoreClasses(){"use strict";function e(e,t){e.detach().appendTo(t).css({position:"absolute",left:0,top:0})}var t,n,s,a,o;for(t in classLocations)classLocations.hasOwnProperty(t)&&(n=$('[id="'+t+'"]'),s=shadowList[t],a=$("#"+classLocations[t]),o=a.find(s),e(n,a),n.find(".class-capacity").html(o.data("capacity")))}function checkFields(){var e=document.getElementById("startTime"),t=document.getElementById("endTime"),n=to24H(e.value.replace(":00 ","")),s=to24H(t.value.replace(":00 ","")),a=$('input[type="radio"][name="customDay"]').parent(".active").data("day"),i=(document.getElementById("customTitle"),document.getElementById("addcustom"));return void 0===s&&void 0!==n&&(s=to12H(n+1),t.value=s),void 0===n||void 0===s?!1:n>=s?(t.style.color="red",i.disabled=!0,!1):(i.disabled=!1,t.style.color="",void 0===a?!1:!0)}function pageError(e,t){var n=$("<div>").addClass("alert alert-warning alert-dismissible fade show").attr("role","alert"),s=$('<button type="button" data-dismiss="alert" aria-label="Close">').addClass("close").html('<span aria-hidden="true">&times;</span>'),a="<strong>"+e+"</strong> "+t,o=$("#alert-space");n.html(a).prepend(s),n.appendTo(o),o.children().length>3&&o.children().first().alert("close")}function clearLists(e){"use strict";classList=[],shadowList={},e!==!0&&(classLocations={})}var finishedInit=!1,courseList=["CBS"],classList=[],shadowList={},classLocations={},ttCellHeight=50,ttHeadHeight=40,waitingScripts=0,timetableData={},metadata={},customClasses=[],optionMemory={};$.fn.push=function(e){"use strict";return Array.prototype.push.apply(this,$.makeArray($(e))),this},function(){"use strict";$(document).ready(function(){createTable(),$("#showcap").change(function(){var e=$(".class-capacity:parent");document.getElementById("showcap").checked===!0?e.show():e.hide()}),$("#showloc").change(function(){var e=$(".class-location:parent");document.getElementById("showloc").checked===!0?e.show():e.hide()}),$(".savedOption").change(function(){saveState()}),$(".generateOption").change(function(){updateWarning()}),$("#saveimage").click(function(){timetableToPNG()}),$("#addcustom").click(function(){addCustom()}),$("#customClass").on("hidden.bs.modal",function(){document.getElementById("addcustom").innerHTML="Add",document.getElementById("customID").value=""}),$('.clockpicker input[type="text"]').change(function(){checkFields()}),$('[data-toggle="tooltip"]').tooltip({container:"body"})}),$.getJSON("data/timetable.json",function(e){timetableData=e[0],metadata=e[1],$(document).ready(function(){var t;if(document.getElementById("meta-sem").innerHTML=metadata.sem,document.getElementById("meta-year").innerHTML=metadata.year,document.getElementById("meta-update").innerHTML=metadata.updated+" at "+metadata.uptimed,init_typeahead(),t=Cookies.getJSON("prevVisit")||!1,t===!1){var n=getRandomInt();Cookies.set("prevVisit",[n,1],{expires:182}),$("#helppanel").modal("show")}else t[1]+=1,Cookies.set("prevVisit",t,{expires:182}),restoreState(e);var s=$("#cp_start").clockpicker({placement:"bottom",align:"left","default":12,donetext:"Done",twelvehour:!0,amOrPm:"PM",breakHour:9,afterHourSelect:function(){s.clockpicker("update")},afterUpdate:function(){checkFields()}}),a=$("#cp_end").clockpicker({placement:"bottom",align:"left","default":12,donetext:"Done",twelvehour:!0,amOrPm:"PM",breakHour:10,afterHourSelect:function(){a.clockpicker("update")},afterUpdate:function(){checkFields()}});finishedInit=!0})})}();
