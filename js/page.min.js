function restoreState(e){"use strict";var c,t=Cookies.getJSON("options"),s=Cookies.getJSON("courses");if(classLocations=Cookies.getJSON("classLocations"),void 0!==t){for(c=0;c<s.length;c+=1)"CBS"!==s[c]&&addCourse(s[c]+" - "+e[s[c]]);document.getElementById("tbt").checked=t.cbs.tbt,document.getElementById("bib").checked=t.cbs.bib,document.getElementById("ctr").checked=t.cbs.ctr,document.getElementById("cth").checked=t.cbs.cth,document.getElementById("showcap").checked=t.showcap,document.getElementById("fullclasses").checked=t.fullclasses,document.getElementById("showloc").checked=t.showloc,document.getElementById("canclash").checked=t.canclash,"{}"!==JSON.stringify(classLocations)&&generate(!0,!0)}}function saveState(){"use strict";if(finishedInit){Cookies.set("courses",courseList,{expires:182});var e={cbs:{}};e.cbs.tbt=document.getElementById("tbt").checked,e.cbs.bib=document.getElementById("bib").checked,e.cbs.ctr=document.getElementById("ctr").checked,e.cbs.cth=document.getElementById("cth").checked,e.showcap=document.getElementById("showcap").checked,e.fullclasses=document.getElementById("fullclasses").checked,e.showloc=document.getElementById("showloc").checked,e.canclash=document.getElementById("canclash").checked,Cookies.set("options",e,{expires:182}),Cookies.set("classLocations",classLocations,{expires:182})}}function removeCourse(e){"use strict";var t=$(e.currentTarget).parents("div.row"),s=t.parent(),c=t.children().first(),i=c.html().replace(/ -.+/,""),o=courseList.indexOf(i);-1!==o&&courseList.splice(o,1),t.children().fadeOut(200,function(){t.children().show().css("visibility","hidden"),s.slideUp(200,function(){s.remove(),0===$("#courses").children().length&&$("#courses").css("margin-bottom","-10px")})}),saveState()}function addCourse(e){"use strict";courseList.push(e.replace(/ -.*/,""));var t=$("#courses"),s=$("<span>").addClass("glyphicon glyphicon-remove-circle remove-icon").attr("aria-hidden",!0).click(removeCourse),c=$("<div>").append($('<div class="row">').html('<div class="col-10">'+e+"</div>").append($('<div class="col-2" style="text-align: right;">').append(s)));t.append(c).css("margin-bottom",0),c.children().hide(),c.hide().slideDown(200,function(){c.children().fadeIn(200)}),saveState()}function timetableToPNG(){"use strict";var e=document.getElementById("timetable");$(e).width();$(e).removeClass("scroll-x"),$(e).width(720),domtoimage.toPng(e).then(function(t){$(e).addClass("scroll-x"),$(e).css("width","auto"),download(t,"timetable.png","image/png")})}function hasClass(e,t){"use strict";var s=" "+e.className+" ";return-1!==s.indexOf(" "+t+" ")}function hideEmpty(e,t){"use strict";var s=$(".class-shadow"),c=$("#timetable").find(".body"),i=$();c.show(),e=e||1/0,t=t||-(1/0),e===1/0&&s.each(function(s,c){var i=$(c).parent().position().top;e=Math.min(e,i),t=Math.max(t,i+$(c).height())}),c.each(function(s,c){var o=$(c).position().top;(e>o||o>=t)&&(i=i.add(c))}),i.hide()}function getColour(e){"use strict";var t=[[19,111,225],[160,29,33],[0,140,72],[102,44,145],[255,107,0],[10,28,210],[238,46,20]];return t[e%t.length].join(",")}function startDrag(e,t){"use strict";var s=$(e.target),c=s.attr("id"),i=shadowList[c];i.fadeIn(100)}function stopDrag(e,t){"use strict";function s(e,t){e.detach().appendTo(t).css({left:0,top:0})}var a,n,c=$(e.target),i=c.width()/2*c.width()/2,o=null;$(".class-shadow:visible").each(function(){var e=$(this).offset(),t=c.offset(),s=Math.pow(e.left-t.left,2)+Math.pow(e.top-t.top,2);i>s&&(i=s,o=$(this))}),null!==o&&(a=c.attr("id"),n=shadowList[a].index(o),$('.class-drag[id^="'+a.replace(/\d$/,"")+'"]').each(function(){var e=$(this),t=$(shadowList[e.attr("id")][n]);s(e,t.parent()),e.find(".class-capacity").html(t.data("capacity")),classLocations[e.attr("id")]=t.parent().attr("id"),saveState()})),$(".class-shadow").fadeOut(200)}function unique(e,t){"use strict";var o,s=[],c=[],i=[];for(o=0;o<e.length;o+=1)-1===i.indexOf(String(e[o]))&&(s.push(e[o]),i.push(String(e[o])),void 0!==t&&c.push(t[o]));for(o=0;o<s.length;o+=1)e[o]=s[o],void 0!==t&&(t[o]=c[o]);for(;o<e.length;)e.pop(),void 0!==t&&t.pop()}function createClass(e,t,s){"use strict";var r,l,d,u,h,f,p,m,c=e.time,i=e.enrols,o=e.course,a=e.component,n=e.location,g='<div style="font-weight: bold">'+("CBS"!==o?o+": "+a:a)+"</div>",v=0;for(i="CBS"!==o?'<div class="class-capacity">'+i.replace(","," / ")+"</div>":'<div class="class-capacity"></div>',d=0;d<c.length;d+=1)r=c[d],l='<div class="class-location">'+n[d]+"</div>",-1===s.indexOf(r.join(",")+o+a)?(s.push(r.join(",")+o+a),u=o+a+(d-v),h=r[2]-r[1],f=(r[0]+r[1]).replace(".5","_30"),p=$("#"+f),m=$('<div class="class-drag" id="'+u+'">').append($("<div>").html(g+l+i)).draggable({stack:".class-drag",scroll:!0,containment:p.parents(".row"),start:startDrag,stop:stopDrag}).css({position:"absolute","background-color":"rgb("+getColour(t)+")"}),m.appendTo(p),m.height(p.outerHeight()*h*2),classList.push(m),classLocations.hasOwnProperty(u)||(classLocations[u]=f)):v+=1;document.getElementById("showcap").checked||$(".class-capacity").hide(),document.getElementById("showloc").checked||$(".class-location").hide()}function createShadow(e,t,s){"use strict";var c,i,o,a,n,r,l,d,f,p,m,g,v,y,w,b;for(c=e.time,i=e.course+e.component,o=e.enrols,a=e.location,y=1/0,w=-(1/0),0===i.indexOf("CBS")&&(o=""),unique(c,a),d=0;d<c.length;d+=1)r=c[d],l=r.join(","),n=a[d],g=i+d,s.hasOwnProperty(i)?s[i].push(l):s[i]=[l],m=r[2]-r[1],p=$("#"+(r[0]+r[1]).replace(".5","_30")),f=$('<div class="class-shadow">').css({"background-color":"rgba("+getColour(t)+", 0.7)"}),f.data("capacity",o.replace(","," / ")),f.data("location",n.replace(","," / ")),f.appendTo(p),b=p.outerHeight()*m*2,f.height(b),shadowList.hasOwnProperty(g)?shadowList[g]=shadowList[g].push(f):shadowList[g]=f,v=f.position().top,y=Math.min(y,v),w=Math.max(w,v+b);return{min:y,max:w}}function restoreClasses(){"use strict";function e(e,t){e.detach().appendTo(t).css({position:"absolute",left:0,top:0})}var t,s,c,i,o;for(t in classLocations)classLocations.hasOwnProperty(t)&&(s=$('[id="'+t+'"]'),c=shadowList[t],i=$("#"+classLocations[t]),o=i.find(c),e(s,i),s.find(".class-capacity").html(o.data("capacity")))}function clearLists(e){"use strict";classList=[],shadowList={},e!==!0&&(classLocations={})}var finishedInit=!1,courseList=["CBS"],classList=[],shadowList={},classLocations={};$.fn.push=function(e){"use strict";return Array.prototype.push.apply(this,$.makeArray($(e))),this},function(){"use strict";function t(){var t=function(e){return function(t,s){var c=[],i=[],o=courseList;t=t.toLowerCase(),$.each(e,function(e,s){if(o.indexOf(e)>=0)return!0;var a=e+" - "+s,n=a.toLowerCase().indexOf(t);n>0?c.push(a):0===n&&i.push(a)}),i.sort(),i.length<10&&c.length>0&&(c.sort(),i=i.concat(c)),s(i.slice(0,10))}};$(".typeahead.coursein").typeahead({name:"courses",source:t(e)})}var e;$.getJSON("data/courses.json",function(s){e=s,$(document).ready(function(){t(),$("#showcap").change(function(){var e=$(".class-capacity");document.getElementById("showcap").checked===!0?e.show():e.hide()}),$("#showloc").change(function(){var e=$(".class-location");document.getElementById("showloc").checked===!0?e.show():e.hide()}),$(".savedOption").change(function(){saveState()}),$("#saveimage").click(function(){timetableToPNG()}),restoreState(s),finishedInit=!0})})}();
