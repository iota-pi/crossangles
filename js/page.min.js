function removeCourse(t){"use strict";var e=$(t.currentTarget).parents("div.row"),s=e.parent(),c=e.children().first(),i=c.html().replace(/ -.+/,""),a=courseList.indexOf(i);-1!==a&&courseList.splice(a,1),e.children().fadeOut(200,function(){e.children().show().css("visibility","hidden"),s.slideUp(200,function(){s.remove(),0===$("#courses").children().length&&$("#courses").css("margin-bottom","-10px")})})}function addCourse(t){"use strict";courseList.push(t.replace(/ -.*/,""));var e=$("#courses"),s=$("<span>").addClass("glyphicon glyphicon-remove-circle remove-icon").attr("aria-hidden",!0).click(removeCourse),c=$("<div>").append($('<div class="row">').html('<div class="col-10">'+t+"</div>").append($('<div class="col-2" style="text-align: right;">').append(s)));e.append(c).css("margin-bottom",0),c.children().hide(),c.hide().slideDown(200,function(){c.children().fadeIn(200)})}function restoreState(t){"use strict";var c,e=Cookies.getJSON("options"),s=Cookies.getJSON("courses");if(void 0!==e){for(c=0;c<s.length;c+=1)"CBS"!==s[c]&&addCourse(s[c]+" - "+t[s[c]]);document.getElementById("tbt").checked=e.cbs.tbt,document.getElementById("bib").checked=e.cbs.bib,document.getElementById("ctr").checked=e.cbs.ctr,document.getElementById("cth").checked=e.cbs.cth,document.getElementById("showcap").checked=e.showcap,document.getElementById("fullclasses").checked=e.fullclasses,classLocations=Cookies.getJSON("classLocations"),"{}"!==JSON.stringify(classLocations)&&generate(!0,!0)}}function saveState(){"use strict";Cookies.set("courses",courseList);var t={cbs:{}};t.cbs.tbt=document.getElementById("tbt").checked,t.cbs.bib=document.getElementById("bib").checked,t.cbs.ctr=document.getElementById("ctr").checked,t.cbs.cth=document.getElementById("cth").checked,t.showcap=document.getElementById("showcap").checked,t.fullclasses=document.getElementById("fullclasses").checked,Cookies.set("options",t),Cookies.set("classLocations",classLocations)}function timetableToPNG(){"use strict";var t=document.getElementById("timetable");$(t).width();$(t).removeClass("scroll-x"),$(t).width(720),domtoimage.toPng(t).then(function(e){$(t).addClass("scroll-x"),$(t).css("width","auto"),download(e,"timetable.png","image/png")})}function getColour(t){"use strict";var e=[[19,111,225],[160,29,33],[0,140,72],[102,44,145],[255,107,0],[10,28,210],[238,46,20]];return e[t%e.length].join(",")}function startDrag(t,e){"use strict";var s=$(t.target),c=s.attr("id"),i=shadowList[c];i.fadeIn(100),s.css({position:"relative"})}function stopDrag(t,e){"use strict";function s(t,e){t.detach().appendTo(e).css({position:"absolute",left:0,top:0})}var o,n,c=$(t.target),i=c.width()/2*c.width()/2,a=null;$(".class-shadow:visible").each(function(){var t=$(this).offset(),e=c.offset(),s=Math.pow(t.left-e.left,2)+Math.pow(t.top-e.top,2);i>s&&(i=s,a=$(this))}),null!==a&&(o=c.attr("id"),n=shadowList[o].index(a),$('.class-drag[id^="'+o.replace(/\d$/,"")+'"]').each(function(){var t=$(this),e=$(shadowList[t.attr("id")][n]);s(t,e.parent()),t.find(".class-capacity").html(e.data("capacity")),classLocations[t.attr("id")]=e.parent().attr("id"),saveState()})),$(".class-shadow").fadeOut(200)}function unique(t){"use strict";var c,e=[],s=[];for(c=0;c<t.length;c+=1)-1===s.indexOf(String(t[c]))&&(e.push(t[c]),s.push(String(t[c])));return e}function createClass(t,e,s,c,i,a){"use strict";var o,n,r,d,l,u,h,p="<div>"+("CBS"!==s?s+": "+c:c)+"</div>",f=0;for(e="CBS"!==s?'<div class="class-capacity">'+e.replace(","," / ")+"</div>":'<div class="class-capacity"></div>',n=0;n<t.length;n+=1)o=t[n],-1===a.indexOf(o.join(",")+s+c)?(a.push(o.join(",")+s+c),r=s+c+(n-f),d=o[2]-o[1],l=(o[0]+o[1]).replace(".5","_30"),u=$("#"+l),h=$('<div class="class-drag" id="'+r+'">').append($("<div>").html(p+e)).draggable({stack:".class-drag",scroll:!0,containment:u.parents(".row"),start:startDrag,stop:stopDrag}).css({position:"absolute","background-color":"rgb("+getColour(i)+")"}),h.appendTo(u),h.height(u.outerHeight()*d*2),classList.push(h),classLocations.hasOwnProperty(r)||(classLocations[r]=l)):f+=1;document.getElementById("showcap").checked||$(".class-capacity").hide()}function createShadow(t,e,s,c,i){"use strict";0===e.indexOf("CBS")&&(c=""),t=unique(t);var a,o,n,l,u,h,p;for(n=0;n<t.length;n+=1)a=t[n],o=a.join(","),p=e+n,i.hasOwnProperty(e)?i[e].push(o):i[e]=[o],h=a[2]-a[1],u=$("#"+(a[0]+a[1]).replace(".5","_30")),l=$('<div class="class-shadow">').css({"background-color":"rgba("+getColour(s)+", 0.7)"}),l.data("capacity",c.replace(","," / ")),l.appendTo(u),l.height(u.outerHeight()*h*2),shadowList.hasOwnProperty(p)?shadowList[p]=shadowList[p].push(l):shadowList[p]=l}function restoreClasses(){"use strict";function t(t,e){t.detach().appendTo(e).css({position:"absolute",left:0,top:0})}var e,s,c,i,a;for(e in classLocations)classLocations.hasOwnProperty(e)&&(s=$('[id="'+e+'"]'),c=shadowList[e],i=$("#"+classLocations[e]),a=i.find(c),t(s,i),s.find(".class-capacity").html(a.data("capacity")))}function clearLists(t){"use strict";classList=[],shadowList={},t!==!0&&(classLocations={})}var courseList=["CBS"],classList=[],shadowList={},classLocations={};$.fn.push=function(t){"use strict";return Array.prototype.push.apply(this,$.makeArray($(t))),this},function(){"use strict";function e(){var e=function(t){return function(e,s){var c=[],i=[],a=courseList;e=e.toLowerCase(),$.each(t,function(t,s){if(a.indexOf(t)>=0)return!0;var o=t+" - "+s,n=o.toLowerCase().indexOf(e);n>0?c.push(o):0===n&&i.push(o)}),i.sort(),i.length<10&&c.length>0&&(c.sort(),i=i.concat(c)),s(i.slice(0,10))}};$(".typeahead.coursein").typeahead({name:"courses",source:e(t)})}var t;$.getJSON("data/courses.json",function(s){t=s,$(document).ready(function(){e(),$("#showcap").change(function(){var t=$(".class-capacity");document.getElementById("showcap").checked===!0?t.show():t.hide()}),$(".savedOption").change(function(){saveState()}),$("#saveimage").click(function(){timetableToPNG()}),restoreState(s)})})}();
