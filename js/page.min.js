function restoreState(e){"use strict";var s,t=Cookies.getJSON("options"),n=Cookies.getJSON("courses");if(classLocations=Cookies.getJSON("classLocations"),void 0!==t){for(s=0;s<n.length;s+=1)"CBS"!==n[s]&&addCourse(n[s]+" - "+e[n[s]]);document.getElementById("tbt").checked=t.cbs.tbt,document.getElementById("bib").checked=t.cbs.bib,document.getElementById("ctr").checked=t.cbs.ctr,document.getElementById("cth").checked=t.cbs.cth,document.getElementById("showcap").checked=t.showcap,document.getElementById("fullclasses").checked=t.fullclasses,document.getElementById("showloc").checked=t.showloc,document.getElementById("canclash").checked=t.canclash,"{}"!==JSON.stringify(classLocations)&&generate(!0,!0)}}function saveState(){"use strict";if(finishedInit){Cookies.set("courses",courseList,{expires:182});var e={cbs:{}};e.cbs.tbt=document.getElementById("tbt").checked,e.cbs.bib=document.getElementById("bib").checked,e.cbs.ctr=document.getElementById("ctr").checked,e.cbs.cth=document.getElementById("cth").checked,e.showcap=document.getElementById("showcap").checked,e.fullclasses=document.getElementById("fullclasses").checked,e.showloc=document.getElementById("showloc").checked,e.canclash=document.getElementById("canclash").checked,Cookies.set("options",e,{expires:182}),Cookies.set("classLocations",classLocations,{expires:182})}}function removeCourse(e){"use strict";var t=$(e.currentTarget).parents("div.row"),n=t.parent(),s=t.children().first(),o=s.html().replace(/ -.+/,""),i=courseList.indexOf(o);-1!==i&&courseList.splice(i,1),t.children().fadeOut(200,function(){t.children().show().css("visibility","hidden"),n.slideUp(200,function(){n.remove(),0===$("#courses").children().length&&$("#courses").css("margin-bottom","-10px")})}),saveState()}function addCourse(e){"use strict";courseList.push(e.replace(/ -.*/,""));var t=$("#courses"),n=$("<span>").addClass("glyphicon glyphicon-remove-circle remove-icon").attr("aria-hidden",!0).click(removeCourse),s=$("<div>").append($('<div class="row">').html('<div class="col-10">'+e+"</div>").append($('<div class="col-2" style="text-align: right;">').append(n)));t.append(s).css("margin-bottom",0),s.children().hide(),s.hide().slideDown(200,function(){s.children().fadeIn(200)}),saveState()}function timetableToPNG(){"use strict";var e=document.getElementById("timetable");$(e).width();$(e).removeClass("scroll-x"),$(e).width(720),domtoimage.toPng(e).then(function(t){$(e).addClass("scroll-x"),$(e).css("width","auto"),download(t,"timetable.png","image/png")})}function getColour(e){"use strict";var t=[[19,111,225],[160,29,33],[0,140,72],[102,44,145],[255,107,0],[10,28,210],[238,46,20]];return t[e%t.length].join(",")}function startDrag(e,t){"use strict";var n=$(e.target),s=n.attr("id"),o=shadowList[s];o.fadeIn(100)}function stopDrag(e,t){"use strict";function n(e,t){e.detach().appendTo(t).css({left:0,top:0})}var r,a,s=$(e.target),o=s.width()/2*s.width()/2,i=null;$(".class-shadow:visible").each(function(){var e=$(this).offset(),t=s.offset(),n=Math.pow(e.left-t.left,2)+Math.pow(e.top-t.top,2);o>n&&(o=n,i=$(this))}),null!==i&&(r=s.attr("id"),a=shadowList[r].index(i),$('.class-drag[id^="'+r.replace(/\d$/,"")+'"]').each(function(){var e=$(this),t=$(shadowList[e.attr("id")][a]);n(e,t.parent()),e.find(".class-capacity").html(t.data("capacity")),classLocations[e.attr("id")]=t.parent().attr("id"),saveState()})),$(".class-shadow").fadeOut(200)}function unique(e,t){"use strict";var i,n=[],s=[],o=[];for(i=0;i<e.length;i+=1)-1===o.indexOf(String(e[i]))&&(n.push(e[i]),o.push(String(e[i])),void 0!==t&&s.push(t[i]));for(i=0;i<n.length;i+=1)e[i]=n[i],void 0!==t&&(t[i]=s[i]);for(;i<e.length;)e.pop(),void 0!==t&&t.pop()}function createClass(e,t,n){"use strict";var c,l,u,f,d,h,m,p,s=e.time,o=e.enrols,i=e.course,r=e.component,a=e.location,g='<div style="font-weight: bold">'+("CBS"!==i?i+": "+r:r)+"</div>",S=0;for(o="CBS"!==i?'<div class="class-capacity">'+o.replace(","," / ")+"</div>":'<div class="class-capacity"></div>',u=0;u<s.length;u+=1)c=s[u],l='<div class="class-location">'+a[u]+"</div>",-1===n.indexOf(c.join(",")+i+r)?(n.push(c.join(",")+i+r),f=i+r+(u-S),d=c[2]-c[1],h=(c[0]+c[1]).replace(".5","_30"),m=$("#"+h),p=$('<div class="class-drag" id="'+f+'">').append($("<div>").html(g+l+o)).draggable({stack:".class-drag",scroll:!0,containment:m.parents(".row"),start:startDrag,stop:stopDrag}).css({position:"absolute","background-color":"rgb("+getColour(t)+")"}),p.appendTo(m),p.height(m.outerHeight()*d*2),classList.push(p),classLocations.hasOwnProperty(f)||(classLocations[f]=h)):S+=1;document.getElementById("showcap").checked||$(".class-capacity").hide(),document.getElementById("showloc").checked||$(".class-location").hide()}function createShadow(e,t,n){"use strict";var s,o,i,r,a,c,l,u,h,m,p,g;for(s=e.time,o=e.course+e.component,i=e.enrols,r=e.location,0===o.indexOf("CBS")&&(i=""),unique(s,r),u=0;u<s.length;u+=1)c=s[u],l=c.join(","),a=r[u],g=o+u,n.hasOwnProperty(o)?n[o].push(l):n[o]=[l],p=c[2]-c[1],m=$("#"+(c[0]+c[1]).replace(".5","_30")),h=$('<div class="class-shadow">').css({"background-color":"rgba("+getColour(t)+", 0.7)"}),h.data("capacity",i.replace(","," / ")),h.data("location",a.replace(","," / ")),h.appendTo(m),h.height(m.outerHeight()*p*2),shadowList.hasOwnProperty(g)?shadowList[g]=shadowList[g].push(h):shadowList[g]=h}function restoreClasses(){"use strict";function e(e,t){e.detach().appendTo(t).css({position:"absolute",left:0,top:0})}var t,n,s,o,i;for(t in classLocations)classLocations.hasOwnProperty(t)&&(n=$('[id="'+t+'"]'),s=shadowList[t],o=$("#"+classLocations[t]),i=o.find(s),e(n,o),n.find(".class-capacity").html(i.data("capacity")))}function clearLists(e){"use strict";classList=[],shadowList={},e!==!0&&(classLocations={})}var finishedInit=!1,courseList=["CBS"],classList=[],shadowList={},classLocations={};$.fn.push=function(e){"use strict";return Array.prototype.push.apply(this,$.makeArray($(e))),this},function(){"use strict";function t(){var t=function(e){return function(t,n){var s=[],o=[],i=courseList;t=t.toLowerCase(),$.each(e,function(e,n){if(i.indexOf(e)>=0)return!0;var r=e+" - "+n,a=r.toLowerCase().indexOf(t);a>0?s.push(r):0===a&&o.push(r)}),o.sort(),o.length<10&&s.length>0&&(s.sort(),o=o.concat(s)),n(o.slice(0,10))}};$(".typeahead.coursein").typeahead({name:"courses",source:t(e)})}var e;$.getJSON("data/courses.json",function(n){e=n,$(document).ready(function(){t(),$("#showcap").change(function(){var e=$(".class-capacity");document.getElementById("showcap").checked===!0?e.show():e.hide()}),$("#showloc").change(function(){var e=$(".class-location");document.getElementById("showloc").checked===!0?e.show():e.hide()}),$(".savedOption").change(function(){saveState()}),$("#saveimage").click(function(){timetableToPNG()}),restoreState(n),finishedInit=!0})})}();
