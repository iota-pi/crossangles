function init_typeahead(){"use strict";for(var e=function(e){return function(t,i){var l,o=[],n=[],r=courseList;for(t=t.toLowerCase(),l=0;l<e.length;l+=1){var a=e[l];if(!(r.indexOf(a)>=0)){var f=a+" - "+timetableData[a][0],c=f.toLowerCase().indexOf(t);c>0?o.push(f):0===c&&n.push(f)}}n.sort(),n.length<10&&o.length>0&&(o.sort(),n=n.concat(o)),i(n.slice(0,10))}};void 0===$().typeahead;);$(".typeahead.coursein").typeahead({name:"courses",source:e(Object.keys(timetableData))})}function restoreState(e){"use strict";var o,t=Cookies.getJSON("options"),i=Cookies.getJSON("courses")||[];if(classLocations=Cookies.getJSON("classLocations")||{},customClasses=Cookies.getJSON("custom")||[],void 0!==t){for(o=0;o<i.length;o+=1)"CBS"!==i[o]&&timetableData.hasOwnProperty(i[o])&&addCourse(i[o]+" - "+timetableData[i[o]][0],!1,!1);for(o=0;o<customClasses.length;o+=1){var n=addCourse(customClasses[o].component,!0,!1);n.data("custom",customClasses[o].course)}document.getElementById("tbt").checked=t.cbs.tbt,document.getElementById("bib").checked=t.cbs.bib,document.getElementById("ctr").checked=t.cbs.ctr,document.getElementById("cth").checked=t.cbs.cth,document.getElementById("showcap").checked=t.showcap,document.getElementById("fullclasses").checked=t.fullclasses,document.getElementById("showloc").checked=t.showloc,document.getElementById("canclash").checked=t.canclash,"{}"!==JSON.stringify(classLocations)&&generate(!0,!0)}}function saveState(e){"use strict";if(finishedInit){Cookies.set("courses",courseList,{expires:182}),Cookies.set("custom",customClasses,{expires:182});var t={cbs:{}};t.cbs.tbt=document.getElementById("tbt").checked,t.cbs.bib=document.getElementById("bib").checked,t.cbs.ctr=document.getElementById("ctr").checked,t.cbs.cth=document.getElementById("cth").checked,t.fullclasses=optionMemory.fullclasses,t.canclash=optionMemory.canclash,t.showcap=document.getElementById("showcap").checked,t.showloc=document.getElementById("showloc").checked,Cookies.set("options",t,{expires:182}),Cookies.set("classLocations",classLocations,{expires:182})}}function restoreClasses(){"use strict";function e(e,t){e.detach().appendTo(t).css({position:"absolute",left:0,top:0})}var t,i,o,n,r;for(t in classLocations)classLocations.hasOwnProperty(t)&&(i=$('[id="'+t+'"]'),o=shadowList[t],n=$("#"+classLocations[t]),r=n.find(o),e(i,n),i.find(".class-capacity").html(r.data("capacity")))}function removeCourse(e){"use strict";var t=$(e.currentTarget).parents(".course"),i=t.children().first(),o=i.html().replace(/ -.+/,"");if(t.data("custom")!==!1){for(var n=0;n<customClasses.length;n+=1)if(customClasses[n].course===t.data("custom")){customClasses.splice(n,1);break}}else-1!==courseList.indexOf(o)&&courseList.splice(courseList.indexOf(o),1);t.children().fadeOut(200,function(){t.children().show().css("visibility","hidden"),t.slideUp(200,function(){t.remove(),0===$("#courses").children().length&&$("#courses").css("margin-bottom","-10px")})}),saveState()}function addCourse(e,t,i){"use strict";t!==!0&&courseList.push(e.replace(/ -.*/,""));var o=$("#courses"),n=$("<span>").addClass("glyphicon glyphicon-remove-circle glyphicon-clickable remove-icon").attr("aria-hidden",!0).attr("data-toggle","tooltip").attr("title","Remove").click(removeCourse),r=$("<span>").addClass("glyphicon glyphicon-edit glyphicon-clickable edit-icon").attr("data-toggle","tooltip").attr("title","Edit").attr("aria-hidden",!0).attr("data-toggle","modal").attr("data-target","#customClass").click(showEdit),l=$("<div>").append(n),a=t!==!0?l:l.prepend(r),f=$('<div class="course">').html("<div>"+e+"</div>").append(a).data("custom",!1);return o.append(f).css("margin-bottom",0),i!==!1&&(f.children().hide(),f.hide().slideDown(200,function(){f.children().fadeIn(200)})),saveState(),f}function to24H(e){if(void 0===e||0===e.length)return void 0;var t=parseInt(e.replace(/\D.*/,""))%12,i=0!==parseInt(e.replace(/\d+:/,"").replace(/ .M/,""));return t+(-1!==e.indexOf("PM")?12:0)+(i?.5:0)}function to12H(e){if(void 0===e||""===e)return void 0;var t=Math.floor(e%12===0?12:e%12),i=e%1===0?"00":"30",o=(10>t?"0"+t:t)+":"+i+" "+(e>=12?"PM":"AM");return o}function getRandomInt(e,t){return e=Math.ceil(e||0),t=Math.floor(t||1e6),Math.floor(Math.random()*(t-e))+e}function uniqueID(){var t,e="custom"+getRandomInt()+"_";for(t=0;t<customClasses.length;t+=1)if(customClasses[t].course===e)return uniqueID();return e}function addCustom(){"use strict";for(var e=document.getElementById("customTitle").value,t=document.getElementById("customLocation").value,i=to24H(document.getElementById("startTime").value),o=to24H(document.getElementById("endTime").value),n=$('input[type="radio"][name="customDay"]').parent(".active").data("day"),r=n+" "+i+(o-i!==1?"-"+o:""),l=document.getElementById("customID").value||uniqueID(),a=getComputedStyle(document.querySelector('input[type="radio"][name="customColour"]:checked'),":before").getPropertyValue("background-color").replace(/rgba\(|, 0\.85\)/g,""),f={time:r,status:"O",enrols:"0,1",course:l,component:e,location:[t],colour:a},c=0;c<customClasses.length;c+=1)if(customClasses[c].course===l){customClasses.splice(c,1);break}customClasses.push(f);var d;"Edit"===document.getElementById("addcustom").innerHTML?($("#courses").children().filter(function(e,t){return $(t).data("custom")===l}).remove(),d=addCourse(e,!0,!1)):d=addCourse(e,!0),d.data("custom",l)}function showEdit(e){"use strict";for(var n,t=$(e.target).parents(".course"),i=t.children().first().html(),o=t.data("custom"),r=0;r<customClasses.length;r+=1)if(customClasses[r].course===o){n=customClasses[r];break}void 0===n&&pageError("Oops!","The list of your courses has become a bit confused. Please try reloading the page, or adding your courses again.");var l=n.time.replace(/.* /,"").split("-"),a=n.time.replace(/ .*/,"");1===l.length&&(l[1]=+l[0]+1),document.getElementById("customID").value=o,document.getElementById("addcustom").innerHTML="Edit",document.getElementById("customTitle").value=i,document.getElementById("customLocation").value=n.location,document.getElementById("startTime").value=to12H(l[0]),document.getElementById("endTime").value=to12H(l[1]),$('input[type="radio"][name="customColour"]').attr("checked",!1).each(function(e,t){return getComputedStyle(t,":before").getPropertyValue("background-color").replace(/rgba\(|, 0\.85\)/g,"")===n.colour?($(t).attr("checked",!0),!1):void 0}),$('input[type="radio"][name="customDay"]').parent().removeClass("active"),$('input[type="radio"][name="customDay"]').parent('[data-day="'+a+'"]').addClass("active"),checkFields()}function checkFields(){var e=document.getElementById("startTime"),t=document.getElementById("endTime"),i=to24H(e.value),o=to24H(t.value),n=$('input[type="radio"][name="customDay"]').parent(".active").data("day"),r=document.getElementById("customTitle").value,l=document.getElementById("addcustom");return void 0===o&&void 0!==i&&(o=to12H(i+1),t.value=o),void 0===i||void 0===o?(l.disabled=!0,!1):i>=o?(t.style.color="red",l.disabled=!0,!1):(t.style.color="",void 0===n||void 0===r||""===r?(l.disabled=!0,!1):(l.disabled=!1,!0))}function canSaveTimetable(){var e=/constructor/i.test(window.HTMLElement)||function(e){return"[object SafariRemoteNotification]"===e.toString()}(!window.safari||"undefined"!=typeof safari&&safari.pushNotification),t=!!document.documentMode,i=!t&&!!window.StyleMedia;return!e&&!i&&!t}function timetableToPNG(){"use strict";var e=document.getElementById("timetable");$(e).width();$(e).removeClass("scroll-x"),$(e).width(720);var i=canSaveTimetable();i?domtoimage.toPng(e).then(function(t){$(e).css("width","auto"),$(e).addClass("scroll-x"),download(t,"timetable.png","image/png")}):domtoimage.toSvg(e).then(function(t){$(e).addClass("scroll-x"),$(e).css("width","auto"),download(t,"timetable.svg","image/svg+xml")})}function hasClass(e,t){"use strict";var i=" "+e.className+" ";return-1!==i.indexOf(" "+t+" ")}function createTable(){"use strict";var c,d,s,u,e=$("#timetable").find(".row"),t='<div class="col col-1 head first"></div><div class="col head">Monday</div><div class="col head">Tuesday</div><div class="col head">Wednesday</div><div class="col head">Thursday</div><div class="col head">Friday</div>',i="",o='<div class="w-100"></div>',n=8,r=21,l=function(e,t){var i="small",o=e;return e+=":00",t===!0&&(o+="_30",e="",i="half"),'<div class="col col-1 body first '+i+'" id="ttrow_'+o+'">'+(t?"":"<div>"+e.replace("_",":")+"</div>")+"</div>"},a=function(e,t,i){var o="";return i===!0&&(e+="_30",o=" half"),'<div class="col body'+o+'" id="'+t+"_"+e+'"></div>'},f=["M","T","W","H","F"];for(c=0;2*(r-n)>c;c+=1){for(d=n+Math.floor(c/2),u=c%2===1,i+=l(d,u),s=0;s<f.length;s+=1)i+=a(d,f[s],u);c!==2*(r-n)-1&&(i+=o)}e.html(t+o+i)}function showEmpty(){"use strict";$("#timetable").find(".body").css("display",null)}function hideEmpty(e,t){"use strict";var o,i=$("#timetable").find(".body");for(o=0;o<i.length;o+=1){var n=i[o],r=ttHeadHeight+ttCellHeight*+n.id.replace(/\D+_/,"").replace("_30","");(e>r||r>=t)&&(n.style.display="none")}}function clearWarning(){document.getElementById("generateWarning");optionMemory.fullclasses=document.getElementById("fullclasses").checked,optionMemory.canclash=document.getElementById("canclash").checked,updateWarning()}function updateWarning(){var e=document.getElementById("generateWarning");document.getElementById("fullclasses").checked!==optionMemory.fullclasses||document.getElementById("canclash").checked!==optionMemory.canclash?(e.innerHTML="Some options have not yet taken effect. Please generate a new timetable to include these options.",e.style.display="block"):(e.innerHTML="",e.style.display="none")}function getColour(e){"use strict";var t=[[19,111,225],[160,29,33],[14,147,40],[102,44,145],[255,107,0],[10,28,210],[238,46,20],[27,98,46]];return t[e%t.length].join(",")}function startDrag(e,t){"use strict";var i=$(e.target),o=i.attr("id"),n=shadowList[o];n.fadeIn(200),$('.class-drag[id^="'+o.replace(/\d$/,"")+'"]').addClass("locked")}function stopDrag(e,t){"use strict";function i(e,t){e.detach().appendTo(t).css({left:0,top:0})}var l,a,o=$(e.target),n=o.width()/2*o.width()/2,r=null;$(".class-shadow:visible").each(function(){var e=$(this).offset(),t=o.offset(),i=Math.pow(e.left-t.left,2)+Math.pow(e.top-t.top,2);n>i&&(n=i,r=$(this))}),null!==r&&(l=o.attr("id"),a=shadowList[l].index(r),$('.class-drag[id^="'+l.replace(/\d$/,"")+'"]').each(function(){var e=$(this),t=$(shadowList[e.attr("id")][a]);i(e,t.parent()),e.find(".class-capacity").html(t.data("capacity")),e.find(".class-location").html(t.data("location")),classLocations[e.attr("id")]!==t.parent().attr("id")&&e.css("z-index",o.css("z-index")),classLocations[e.attr("id")]=t.parent().attr("id")})),$(".class-shadow").fadeOut(200),$(".class-drag.locked").removeClass("locked"),saveState()}function unique(e,t){"use strict";var r,i=[],o=[],n=[];for(r=0;r<e.length;r+=1)-1===n.indexOf(String(e[r]))&&(i.push(e[r]),n.push(String(e[r])),void 0!==t&&o.push(t[r]));for(r=0;r<i.length;r+=1)e[r]=i[r],void 0!==t&&(t[r]=o[r]);for(;r<e.length;)e.pop(),void 0!==t&&t.pop()}function createClassDiv(e,t,i,o,n,r,l){"use strict";var a=$("<div>").attr("id",o).addClass("class-drag").draggable({stack:".class-drag",scroll:!0,containment:l,start:startDrag,stop:stopDrag}),f=a[0];return f.innerHTML="<div>"+e+t+i+"</div>",f.style.position="absolute",f.style.backgroundColor="rgb("+n+")",f.style.height=ttCellHeight*r+"px",a}function createClass(e,t,i){"use strict";var c,d,s,u,h,g,m,p,o=e.time,n=e.enrols,r=e.course,l=e.component,a=e.location,f=e.colour||getColour(t),x='<div style="font-weight: bold">'+(0!==r.indexOf("custom")&&"CBS"!==r?r+": "+l:l)+"</div>",y=0,v=$("#timetable").find(".row");for(n=0!==r.indexOf("custom")&&"CBS"!==r?'<div class="class-capacity">'+n.replace(","," / ")+"</div>":"",s=0;s<o.length;s+=1){c=o[s],d='<div class="class-location">'+a[s]+"</div>";var w=c.join(",")+r+l;-1===i.indexOf(w)?(i.push(w),u=r+l+"_"+(s-y),h=c[2]-c[1],g=(c[0]+"_"+c[1]).replace(".5","_30"),m=$("#"+g),p=createClassDiv(x,d,n,u,f,h,v),""===n&&p.addClass("nocapacity"),p.appendTo(m),classList.push(p),classLocations.hasOwnProperty(u)||(classLocations[u]=g)):y+=1}document.getElementById("showcap").checked||$(".class-capacity").hide(),document.getElementById("showloc").checked||$(".class-location").hide()}function createShadow(e,t){"use strict";var i=e.time,o=e.course+e.component+"_",n=e.enrols,r=e.location,l=e.colour||getColour(t),a=1/0,f=-(1/0);(0===o.indexOf("CBS")||0===e.course.indexOf("custom"))&&(n=""),unique(i,r);var c;for(c=0;c<i.length;c+=1){var v,d=i[c],u=(d.join(","),r[c]),h=o+c,g=d[2]-d[1],m=ttCellHeight*g,p=(d[0]+"_"+d[1]).replace(".5","_30"),x=$("#"+p),y=ttHeadHeight+d[1]*ttCellHeight;v=$('<div class="class-shadow">'),v[0].style.backgroundColor="rgba("+l+", 0.7)",v[0].style.height=m+"px",v.data("capacity",n.replace(","," / ")),v.data("location",u.replace(","," / ")),v.appendTo(x),shadowList.hasOwnProperty(h)?shadowList[h]=shadowList[h].push(v):shadowList[h]=v,a=Math.min(a,-1===p.indexOf("_30")?y:y-ttCellHeight/2),f=Math.max(f,y+m)}return{min:a,max:f}}function pageError(e,t){var i=$("<div>").addClass("alert alert-warning alert-dismissible fade show").attr("role","alert"),o=$('<button type="button" data-dismiss="alert" aria-label="Close">').addClass("close").html('<span aria-hidden="true">&times;</span>'),n="<strong>"+e+"</strong> "+t,r=$("#alert-space");i.html(n).prepend(o),i.appendTo(r),r.children().length>3&&r.children().first().alert("close")}function pageNotice(e,t){var i=$("<div>").addClass("alert alert-success alert-dismissible fade show").attr("role","alert"),o=$('<button type="button" data-dismiss="alert" aria-label="Close">').addClass("close").html('<span aria-hidden="true">&times;</span>'),n="<strong>"+e+"</strong> "+t,r=$("#alert-space");i.html(n).prepend(o),i.appendTo(r),r.children().length>3&&r.children().first().alert("close")}function clearLists(e){"use strict";classList=[],shadowList={},e!==!0&&(classLocations={})}function checkVisible(e,t){var i=e.getBoundingClientRect(),o=Math.max(document.documentElement.clientHeight,window.innerHeight);return t?!(i.top<0||i.bottom>=o):!(i.bottom<0||i.top>=o)}function moveClockPicker(e){var i,t=$(".popover.clockpicker-popover");i="cp_start"===e[0].id?t.first()[0]:t.last()[0];var o=i.getBoundingClientRect(),n=Math.max(document.documentElement.clientHeight,window.innerHeight),r=o.bottom-n;console.log(i,r),r>0?(console.log(i.style.top),i.style.top=+i.style.top.replace("px","")-r+"px",$(i).find(".arrow").hide()):$(i).find(".arrow").show()}var finishedInit=!1,courseList=["CBS"],classList=[],shadowList={},classLocations={},ttCellHeight=50,ttHeadHeight=40,waitingScripts=0,timetableData={},components_index={},locations_index={},times_index={},metadata={},customClasses=[],optionMemory={};$.fn.push=function(e){"use strict";return Array.prototype.push.apply(this,$.makeArray($(e))),this},function(){"use strict";$(document).ready(function(){createTable(),$("#showcap").change(function(){var e=$(".class-capacity:parent");document.getElementById("showcap").checked===!0?e.show():e.hide()}),$("#showloc").change(function(){var e=$(".class-location:parent");document.getElementById("showloc").checked===!0?e.show():e.hide()}),$(".savedOption").change(function(){saveState()}),$(".generateOption").change(function(){updateWarning()}),canSaveTimetable()?$("#saveimage").click(function(){timetableToPNG()}):(document.getElementById("saveimage").style.display="none",document.getElementById("noTimetableDownload").style.display="block"),$("#addcustom").click(function(){addCustom()}),$("#customClass").on("hidden.bs.modal",function(){document.getElementById("addcustom").innerHTML="Add",document.getElementById("customID").value=""}),$("#customClass input").change(function(){checkFields()}),$('#customClass input[type="text"]').keyup(function(){checkFields()}),$('[data-toggle="tooltip"]').tooltip({container:"body"}),objectFitImages()}),$.getJSON("data/timetable.json",function(e){function t(e,t){for(e=""+e;e.length<t;)e+="0";return e}var i,o;for(i in e[0])if(e[0].hasOwnProperty(i))for(o in e[0][i])e[0][i].hasOwnProperty(o)&&(timetableData[i+t(o,4)]=e[0][i][o]);components_index=e[1],locations_index=e[2],times_index=e[3],metadata=e[4],$(document).ready(function(){var t;if(document.getElementById("meta-sem").innerHTML=metadata.sem,document.getElementById("meta-year").innerHTML=metadata.year,document.getElementById("meta-update").innerHTML=metadata.updated+" at "+metadata.uptimed,init_typeahead(),t=Cookies.getJSON("prevVisit")||!1,t===!1){var i=getRandomInt();Cookies.set("prevVisit",[i,1],{expires:182}),$("#helppanel").modal("show"),pageNotice("Did you know?","You can move classes around in the timetable below to suit you better!")}else t[1]+=1,t[1]%3===0&&pageNotice("Did you know?","You can move classes around in the timetable below to suit you better!"),Cookies.set("prevVisit",t,{expires:182}),restoreState(e);var o=$("#cp_start").clockpicker({placement:"bottom",align:"left","default":12,twelvehour:!0,amOrPm:"PM",breakHour:9,afterShow:function(){moveClockPicker(o)},afterUpdate:function(){checkFields()}}),n=$("#cp_end").clockpicker({placement:"bottom",align:"left","default":12,twelvehour:!0,amOrPm:"PM",breakHour:9.5,afterShow:function(){moveClockPicker(n)},afterUpdate:function(){checkFields()}});finishedInit=!0})})}();
