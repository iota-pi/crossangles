function init_typeahead(){"use strict";for(var e=function(e){return function(t,s){var i,a=[],c=[],o=courseList;for(t=t.toLowerCase(),i=0;i<e.length;i+=1){var n=e[i];if(!(o.indexOf(n)>=0)){var r=n+" - "+timetableData[n][0],d=r.toLowerCase().indexOf(t);d>0?a.push(r):0===d&&c.push(r)}}c.sort(),c.length<10&&a.length>0&&(a.sort(),c=c.concat(a)),s(c.slice(0,10))}};void 0===$().typeahead;);$(".typeahead.coursein").typeahead({name:"courses",source:e(Object.keys(timetableData))})}function restoreState(e){"use strict";var a,t=Cookies.getJSON("options"),s=Cookies.getJSON("courses")||[];if(classLocations=Cookies.getJSON("classLocations")||{},customClasses=Cookies.getJSON("custom")||[],void 0!==t){for(a=0;a<s.length;a+=1)"CBS"!==s[a]&&(timetableData.hasOwnProperty(s[a])?addCourse(s[a]+" - "+timetableData[s[a]][0]):(console.log("unnecessary"),addCourse(s[a],!0)));for(a=0;a<customClasses.length;a+=1){var c=addCourse(customClasses[a].component,!0);c.data("custom",customClasses[a].course)}document.getElementById("tbt").checked=t.cbs.tbt,document.getElementById("bib").checked=t.cbs.bib,document.getElementById("ctr").checked=t.cbs.ctr,document.getElementById("cth").checked=t.cbs.cth,document.getElementById("showcap").checked=t.showcap,document.getElementById("fullclasses").checked=t.fullclasses,document.getElementById("showloc").checked=t.showloc,document.getElementById("canclash").checked=t.canclash,"{}"!==JSON.stringify(classLocations)&&generate(!0,!0)}}function saveState(){"use strict";if(finishedInit){Cookies.set("courses",courseList,{expires:182}),Cookies.set("custom",customClasses,{expires:182});var e={cbs:{}};e.cbs.tbt=document.getElementById("tbt").checked,e.cbs.bib=document.getElementById("bib").checked,e.cbs.ctr=document.getElementById("ctr").checked,e.cbs.cth=document.getElementById("cth").checked,e.showcap=document.getElementById("showcap").checked,e.fullclasses=document.getElementById("fullclasses").checked,e.showloc=document.getElementById("showloc").checked,e.canclash=document.getElementById("canclash").checked,Cookies.set("options",e,{expires:182}),Cookies.set("classLocations",classLocations,{expires:182})}}function removeCourse(e){"use strict";var t=$(e.currentTarget).parents("div.row"),s=t.parent(),a=t.children().first(),c=a.html().replace(/ -.+/,"");if(s.data("custom")!==!1){for(var o=0;o<customClasses.length;o+=1)if(customClasses[o].course===s.data("custom")){customClasses.splice(o,1);break}}else-1!==courseList.indexOf(c)&&courseList.splice(courseList.indexOf(c),1);t.children().fadeOut(200,function(){t.children().show().css("visibility","hidden"),s.slideUp(200,function(){s.remove(),0===$("#courses").children().length&&$("#courses").css("margin-bottom","-10px")})}),saveState()}function addCourse(e,t){"use strict";t!==!0&&courseList.push(e.replace(/ -.*/,""));var s=$("#courses"),a=$("<span>").addClass("glyphicon glyphicon-remove-circle glyphicon-clickable remove-icon ").attr("aria-hidden",!0).attr("data-toggle","tooltip").attr("title","Remove").click(removeCourse),c=$("<span>").attr("data-toggle","tooltip").attr("title","Edit").append($("<span>").addClass("glyphicon glyphicon-edit glyphicon-clickable edit-icon").attr("aria-hidden",!0).attr("data-toggle","modal").attr("data-target","#customClass").click(showEdit)),o=$("<div>").addClass("col-2").css("text-align","right").append(a),n=(t!==!0?o:o.prepend(c),$("<div>").addClass("row").html('<div class="col-10">'+e+"</div>").append(o)),r=$("<div>").append(n).data("custom",!1);return s.append(r).css("margin-bottom",0),r.children().hide(),r.hide().slideDown(200,function(){r.children().fadeIn(200)}),saveState(),r}function to24H(e){if(void 0===e||0===e.length)return void 0;var t=parseInt(e.replace(/\D.*/,""))%12;return t+(-1!==e.indexOf("PM")?12:0)}function to12H(e){if(void 0===e||""===e)return void 0;var t=e%12===0?12:e%12,s=(10>t?"0"+t:t)+":00 "+(e>=12?"PM":"AM");return s}function getRandomInt(e,t){return e=Math.ceil(e||0),t=Math.floor(t||1e6),Math.floor(Math.random()*(t-e))+e}function uniqueID(){var t,e="custom"+getRandomInt()+"_";for(t=0;t<customClasses.length;t+=1)if(customClasses[t].course===e)return uniqueID();return e}function addCustom(){"use strict";for(var e=document.getElementById("customTitle").value,t=document.getElementById("customLocation").value,s=to24H(document.getElementById("startTime").value),a=to24H(document.getElementById("endTime").value),c=$('input[type="radio"][name="customDay"]').parent(".active").data("day"),o=c+" "+s+(a-s===1?"-"+a:""),i=document.getElementById("customID").value||uniqueID(),n=getComputedStyle(document.querySelector('input[type="radio"][name="customColour"]:checked'),":before").getPropertyValue("background-color").replace(/rgba\(|, 0\.85\)/g,""),r={time:o,status:"O",enrols:"0,1",course:i,component:e,location:[t],colour:n},d=0;d<customClasses.length;d+=1)if(customClasses[d].course===i){customClasses.splice(d,1);break}customClasses.push(r);var l=addCourse(e,!0);l.data("custom",i),document.getElementById("customID").value=""}function showEdit(e){"use strict";var o,t=$(e.target).parents(".row"),s=t.children().first().html(),a=t.parent(),c=a.data("custom");console.log(c,customClasses);for(var i=0;i<customClasses.length;i+=1)if(customClasses[i].course===c){o=customClasses[i];break}var n=o.time.replace(/.* /,"").split("-"),r=o.time.replace(/ .*/,"");1===n.length&&(n[1]=n[0]+1),document.getElementById("customTitle").value=s,document.getElementById("customLocation").value=o.location,document.getElementById("startTime").value=to12H(n[0]),document.getElementById("endTime").value=to12H(n[1]),$('input[type="radio"][name="customColour"]').attr("checked",!1).each(function(e,t){return getComputedStyle(t,":before").getPropertyValue("background-color").replace(/rgba\(|, 0\.85\)/g,"")===o.colour?($(t).attr("checked",!0),!1):void 0}),$('input[type="radio"][name="customDay"]').parent().removeClass("active"),$('input[type="radio"][name="customDay"]').parent('[data-day="'+r+'"]').addClass("active"),checkFields()}function timetableToPNG(){"use strict";var e=document.getElementById("timetable");$(e).width();$(e).removeClass("scroll-x"),$(e).width(720),domtoimage.toPng(e).then(function(t){$(e).addClass("scroll-x"),$(e).css("width","auto"),download(t,"timetable.png","image/png")})}function hasClass(e,t){"use strict";var s=" "+e.className+" ";return-1!==s.indexOf(" "+t+" ")}function createTable(){"use strict";var d,l,u,h,e=$("#timetable").find(".row"),t='<div class="col col-1 head first"></div><div class="col head">Monday</div><div class="col head">Tuesday</div><div class="col head">Wednesday</div><div class="col head">Thursday</div><div class="col head">Friday</div>',s="",a='<div class="w-100"></div>',c=8,o=21,i=function(e,t){var s="small",a=e;return e+=":00",t===!0&&(a+="_30",e="",s="half"),'<div class="col col-1 body first '+s+'" id="ttrow_'+a+'">'+(t?"":"<div>"+e.replace("_",":")+"</div>")+"</div>"},n=function(e,t,s){var a="";return s===!0&&(e+="_30",a=" half"),'<div class="col body'+a+'" id="'+t+"_"+e+'"></div>'},r=["M","T","W","H","F"];for(d=0;2*(o-c)>d;d+=1){for(l=c+Math.floor(d/2),h=d%2===1,s+=i(l,h),u=0;u<r.length;u+=1)s+=n(l,r[u],h);d!==2*(o-c)-1&&(s+=a)}e.html(t+a+s)}function showEmpty(){"use strict";$("#timetable").find(".body:hidden").show()}function hideEmpty(e,t){"use strict";var s=$(".class-shadow"),a=$("#timetable").find(".body"),c=$();e=e||1/0,t=t||-(1/0),e===1/0&&s.each(function(s,a){var c=$(a).parent().position().top;e=Math.min(e,c),t=Math.max(t,c+$(a).height())}),e!==1/0&&(a.filter('[id^="M"]').not('[id$="_30"]').each(function(s,o){var n,i=$(o).position().top;(e>i||i>=t)&&(n=o.getAttribute("id").replace(/[^_\d]/g,""),c=c.add(a.filter('[id$="'+n+'"]')),c=c.add(a.filter('[id$="'+n+'_30"]')))}),c.hide())}function getColour(e){"use strict";var t=[[19,111,225],[160,29,33],[14,147,40],[102,44,145],[255,107,0],[10,28,210],[238,46,20],[27,98,46]];return t[e%t.length].join(",")}function startDrag(e,t){"use strict";var s=$(e.target),a=s.attr("id"),c=shadowList[a];c.fadeIn(200)}function stopDrag(e,t){"use strict";function s(e,t){e.detach().appendTo(t).css({left:0,top:0})}var i,n,a=$(e.target),c=a.width()/2*a.width()/2,o=null;$(".class-shadow:visible").each(function(){var e=$(this).offset(),t=a.offset(),s=Math.pow(e.left-t.left,2)+Math.pow(e.top-t.top,2);c>s&&(c=s,o=$(this))}),null!==o&&(i=a.attr("id"),n=shadowList[i].index(o),$('.class-drag[id^="'+i.replace(/\d$/,"")+'"]').each(function(){var e=$(this),t=$(shadowList[e.attr("id")][n]);s(e,t.parent()),e.find(".class-capacity").html(t.data("capacity")),classLocations[e.attr("id")]=t.parent().attr("id"),saveState()})),$(".class-shadow").fadeOut(200)}function unique(e,t){"use strict";var o,s=[],a=[],c=[];for(o=0;o<e.length;o+=1)-1===c.indexOf(String(e[o]))&&(s.push(e[o]),c.push(String(e[o])),void 0!==t&&a.push(t[o]));for(o=0;o<s.length;o+=1)e[o]=s[o],void 0!==t&&(t[o]=a[o]);for(;o<e.length;)e.pop(),void 0!==t&&t.pop()}function createClassDiv(e,t,s,a,c,o,i){"use strict";return $("<div>").html("<div>"+e+t+s+"</div>").draggable({stack:".class-drag",scroll:!0,containment:i,start:startDrag,stop:stopDrag}).css({position:"absolute","background-color":"rgb("+c+")",height:ttCellHeight*o}).attr("id",a).addClass("class-drag")}function createClass(e,t,s){"use strict";var d,l,u,h,m,f,p,g,a=e.time,c=e.enrols,o=e.course,i=e.component,n=e.location,r=e.colour||getColour(t),v='<div style="font-weight: bold">'+(0!==o.indexOf("custom")&&"CBS"!==o?o+": "+i:i)+"</div>",y=0,b=$("#timetable").find(".row");for(c=0!==o.indexOf("custom")&&"CBS"!==o?'<div class="class-capacity">'+c.replace(","," / ")+"</div>":"",u=0;u<a.length;u+=1){d=a[u],l='<div class="class-location">'+n[u]+"</div>";var C=d.join(",")+o+i;-1===s.indexOf(C)?(s.push(C),h=o+i+"_"+(u-y),m=d[2]-d[1],f=(d[0]+"_"+d[1]).replace(".5","_30"),p=$("#"+f),g=createClassDiv(v,l,c,h,r,m,b),g.appendTo(p),classList.push(g),classLocations.hasOwnProperty(h)||(classLocations[h]=f)):y+=1}document.getElementById("showcap").checked||$(".class-capacity").hide(),document.getElementById("showloc").checked||$(".class-location").hide()}function createShadow(e,t){"use strict";var s=e.time,a=e.course+e.component+"_",c=e.enrols,o=e.location,i=e.colour||getColour(t),n=1/0,r=-(1/0);(0===a.indexOf("CBS")||0===e.course.indexOf("custom"))&&(c=""),unique(s,o);var d;for(d=0;d<s.length;d+=1){var b,l=s[d],h=(l.join(","),o[d]),m=a+d,f=l[2]-l[1],p=ttCellHeight*f,g=(l[0]+"_"+l[1]).replace(".5","_30"),v=$("#"+g),y=v.position().top;b=$("<div>").css({"background-color":"rgba("+i+", 0.7)",height:p}).addClass("class-shadow"),b.data("capacity",c.replace(","," / ")),b.data("location",h.replace(","," / ")),b.appendTo(v),shadowList.hasOwnProperty(m)?shadowList[m]=shadowList[m].push(b):shadowList[m]=b,n=Math.min(n,-1===g.indexOf("_30")?y:y-ttCellHeight),r=Math.max(r,y+p)}return{min:n,max:r}}function restoreClasses(){"use strict";function e(e,t){e.detach().appendTo(t).css({position:"absolute",left:0,top:0})}var t,s,a,c,o;for(t in classLocations)classLocations.hasOwnProperty(t)&&(s=$('[id="'+t+'"]'),a=shadowList[t],c=$("#"+classLocations[t]),o=c.find(a),e(s,c),s.find(".class-capacity").html(o.data("capacity")))}function checkFields(){var e=document.getElementById("startTime"),t=document.getElementById("endTime"),s=to24H(e.value.replace(":00 ","")),a=to24H(t.value.replace(":00 ","")),c=$('input[type="radio"][name="customDay"]').parent(".active").data("day"),i=(document.getElementById("customTitle"),document.getElementById("addcustom"));return void 0===s||void 0===a||void 0===c?!1:s>=a?(t.style.color="red",i.disabled=!0,!1):(i.disabled=!1,t.style.color="",!0)}function pageError(e,t){var s=$("<div>").addClass("alert alert-warning alert-dismissible fade show").attr("role","alert"),a=$('<button type="button" data-dismiss="alert" aria-label="Close">').addClass("close").html('<span aria-hidden="true">&times;</span>'),c="<strong>"+e+"</strong> "+t,o=$("#alert-space");s.html(c).prepend(a),s.appendTo(o),o.children().length>3&&o.children().first().alert("close")}function clearLists(e){"use strict";classList=[],shadowList={},e!==!0&&(classLocations={})}var finishedInit=!1,courseList=["CBS"],classList=[],shadowList={},classLocations={},ttCellHeight=50,waitingScripts=0,timetableData={},customClasses=[];$.fn.push=function(e){"use strict";return Array.prototype.push.apply(this,$.makeArray($(e))),this},function(){"use strict";$(document).ready(function(){$("#showcap").change(function(){var e=$(".class-capacity:parent");document.getElementById("showcap").checked===!0?e.show():e.hide()}),$("#showloc").change(function(){var e=$(".class-location:parent");document.getElementById("showloc").checked===!0?e.show():e.hide()}),$(".savedOption").change(function(){saveState()}),$("#saveimage").click(function(){timetableToPNG()}),$("#addcustom").click(function(){addCustom()}),$('.clockpicker input[type="text"]').change(function(){checkFields()}),$('[data-toggle="tooltip"]').tooltip({container:"body"});var e=$("#cp_start").clockpicker({placement:"bottom",align:"left","default":12,donetext:"Done",twelvehour:!0,amOrPm:"PM",breakHour:9,afterHourSelect:function(){e.clockpicker("update")},afterUpdate:function(){checkFields()}}),t=$("#cp_end").clockpicker({placement:"bottom",align:"left","default":12,donetext:"Done",twelvehour:!0,amOrPm:"PM",breakHour:10,afterHourSelect:function(){t.clockpicker("update")},afterUpdate:function(){checkFields()}})}),$.getJSON("data/timetable.json",function(e){timetableData=e,$(document).ready(function(){init_typeahead(),createTable(),restoreState(e),finishedInit=!0})})}();
