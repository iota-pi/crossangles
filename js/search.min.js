function search(e,t,n,s){"use strict";function o(e,t){return e[0]!==t[0]?!1:e[3]||t[3]?!1:Math.max(0,Math.min(e[2],t[2])-Math.max(e[1],t[1]))}function a(e,t,n){var s,i,a,r,c,l=0;for(s=0;s<n.length;s+=1)for(i=0;i<t.length;i+=1)for(r=e[i][t[i]],c=r.time,a=0;a<c.length;a+=1)l+=o(n[s],c[a]);return l}function r(e,n,i){for(var o=i[n]+1||0,r=e[n];o<r.length&&(a(e,i,r[o].time)>t||"F"===r[o].status&&!s);)o+=1;return o===r.length?null:o}function c(e,t,n){var i,s=n||0,o=t||[];if(void 0!==n)for(;o.length>n;)o.pop();for(;s<e.length;)if(i=r(e,s,o),null===i){if(s<o.length&&o.pop(),s-=1,0>s)return null}else o[s]=i,s+=1;return o}function l(e){var t,n,s;for(t=e.length-1;t>0;t-=1)n=Math.floor(Math.random()*(t+1)),s=e[t],e[t]=e[n],e[n]=s;return e}function u(e){return e.timetable.map(function(t,n){return e.streams[n][t]})}function d(e,t){return t.score-e.score}function f(t){var s,i,o,n=[];for(i=0;t>i;i+=1){for(s={streams:[],timetable:null,score:null},o=0;o<e.length;o+=1)s.streams.push(l(e[o].slice()));if(s.timetable=c(s.streams),s.score=scoreTimetable(s.timetable,s.streams),null===s.timetable)return null;n.push(s)}return n.sort(d)}function m(e){var n,s,t={streams:[],timetable:null,score:null},i=e.streams.length;for(n=0;n<e.streams.length;n+=1)t.streams.push(e.streams[n].slice());var o=1+Math.floor(3.5*Math.random());for(n=0;o>n;n+=1)s=Math.floor(Math.random()*t.streams.length),i=Math.min(i,s),l(t.streams[s]);return t.timetable=c(t.streams,e.timetable.slice(),i),null===t.timetable?t:(t.score=scoreTimetable(t.timetable,t.streams),t)}function h(e,t,n,s){if(null===e)return null;if(0===n)return e[0];n=n||5e3,t=t||40,s=s||5;var i,o,a,r,c=(new Date).getTime(),l=500;for(i=1;n>=i;i+=1)if(o=Math.floor(Math.random()*(e.length+s))%e.length,a=e[o],r=m(a),null!==r.timetable&&(e.push(r),i%10===0)){for(e.sort(d);e.length>t;)e.pop();if((new Date).getTime()-c>l){console.warn("search(): max execution time reached after "+i+" iterations");break}}return e.sort(d),e[0]}if(void 0===t&&(t=0),0===e.length)return[];s=s||!1;var p=n>0?50:1,g=f(p),v=h(g,void 0,n);return null===v?null:u(v)}
