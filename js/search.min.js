function search(e,t,r){"use strict";function n(e,t){return e[0]!==t[0]?!1:e[3]||t[3]?!1:Math.max(0,Math.min(e[2],t[2])-Math.max(e[1],t[1]))}function l(e,t,r){var l,a,i,s,u,o=0;for(l=0;l<r.length;l+=1)for(a=0;a<t.length;a+=1)for(s=e[a][t[a]],u=s.time,i=0;i<u.length;i+=1)o+=n(r[l],u[i]);return o}function a(e,r,n){for(var a=n[r]+1||0,i=e[r];a<i.length&&l(e,n,i[a].time)>t;)a+=1;return a===i.length?null:a}function i(e,t,r){var l,n=r||0,i=t||[];if(void 0!==r)for(;i.length>r;)i.pop();for(;n<e.length;)if(l=a(e,n,i),null===l){if(n<i.length&&i.pop(),n-=1,0>n)return null}else i[n]=l,n+=1;return i}function s(e){var t,r,n;for(t=e.length-1;t>0;t-=1)r=Math.floor(Math.random()*(t+1)),n=e[t],e[t]=e[r],e[r]=n;return e}function u(e,t){return t.score-e.score}function o(t){var n,l,a,r=[];for(l=0;t>l;l+=1){for(n={streams:[],timetable:null,score:null},a=0;a<e.length;a+=1)n.streams.push(s(e[a].slice()));if(n.timetable=i(n.streams),n.score=scoreTimetable(n.timetable,n.streams),null===n.timetable)return null;r.push(n)}return r.sort(u)}function f(e){var r,n,t={streams:[],timetable:null,score:null};for(r=0;r<e.streams.length;r+=1)t.streams.push(e.streams[r].slice());for(;null===t.timetable;)n=Math.floor(Math.random()*t.streams.length),s(t.streams[n]),t.timetable=i(t.streams,e.timetable.slice(),n);return t.score=scoreTimetable(t.timetable,t.streams),t}function m(e,t,r,n){if(null===e)return null;if(0===r)return e[0];r=r||5e3,t=t||20,n=n||5;var l,a,i,s,o=(new Date).getTime(),m=500;for(l=0;r>l;l+=1)if(a=Math.floor(Math.random()*(e.length+n))%e.length,i=e[a],s=f(i),e.push(s),l%10===9){for(e.sort(u);e.length>t;)e.pop();if((new Date).getTime()-o>m){console.warn("search(): max execution time reached after "+l+" iterations");break}}return e.sort(u),e[0]}if(void 0===t&&(t=0),0===e.length)return[];var h=r>0?50:1,c=o(h),g=m(c,void 0,r);return null===g?(console.error("No timetables could be generated!"),null):g.timetable.map(function(e,t){return g.streams[t][e]})}
