function search(e,t,s){"use strict";function i(e,t){return e[0]!==t[0]?!1:e[3]||t[3]?!1:Math.max(0,Math.min(e[2],t[2])-Math.max(e[1],t[1]))}function c(e,t,s){var c,a,o,n,r,d=0;for(c=0;c<s.length;c+=1)for(a=0;a<t.length;a+=1)for(n=e[a][t[a]],r=n.time,o=0;o<r.length;o+=1)d+=i(s[c],r[o]);return d}function a(e,s,i){for(var a=i[s]+1||0,o=e[s];a<o.length&&c(e,i,o[a].time)>t;)a+=1;return a===o.length?null:a}function o(e,t,s){var c,i=s||0,o=t||[];if(void 0!==s)for(;o.length>s;)o.pop();for(;i<e.length;)if(c=a(e,i,o),null===c){if(i<o.length&&o.pop(),i-=1,0>i)return null}else o[i]=c,i+=1;return o}function n(e){var t,s,i;for(t=e.length-1;t>0;t-=1)s=Math.floor(Math.random()*(t+1)),i=e[t],e[t]=e[s],e[s]=i;return e}function r(e,t){return t.score-e.score}function d(t){var i,c,a,s=[];for(c=0;t>c;c+=1){for(i={streams:[],timetable:null,score:null},a=0;a<e.length;a+=1)i.streams.push(n(e[a].slice()));if(i.timetable=o(i.streams),i.score=scoreTimetable(i.timetable,i.streams),null===i.timetable)return null;s.push(i)}return s.sort(r)}function l(e){var s,i,t={streams:[],timetable:null,score:null};for(s=0;s<e.streams.length;s+=1)t.streams.push(e.streams[s].slice());for(;null===t.timetable;)i=Math.floor(Math.random()*t.streams.length),n(t.streams[i]),t.timetable=o(t.streams,e.timetable.slice(),i);return t.score=scoreTimetable(t.timetable,t.streams),t}function u(e,t,s,i){if(null===e)return null;if(0===s)return e[0];s=s||5e3,t=t||20,i=i||5;var c,a,o,n,d=(new Date).getTime(),u=500;for(c=0;s>c;c+=1)if(a=Math.floor(Math.random()*(e.length+i))%e.length,o=e[a],n=l(o),e.push(n),c%10===9){for(e.sort(r);e.length>t;)e.pop();if((new Date).getTime()-d>u){console.warn("search(): max execution time reached after "+c+" iterations");break}}return e.sort(r),e[0]}if(void 0===t&&(t=0),0===e.length)return[];var h=s>0?50:1,f=d(h),p=u(f,void 0,s);return null===p?(console.error("No timetables could be generated!"),null):p.timetable.map(function(e,t){return p.streams[t][e]})}
