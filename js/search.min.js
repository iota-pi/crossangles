function search(t,e,s){"use strict";function c(t,e){return t[0]!==e[0]?!1:Math.max(0,Math.min(t[2],e[2])-Math.max(t[1],e[1]))}function i(t,e,s){var i,a,o,n,r,d=0;for(i=0;i<s.length;i+=1)for(a=0;a<e.length;a+=1)for(n=t[a][e[a]],r=n.time,o=0;o<r.length;o+=1)d+=c(s[i],r[o]);return d}function a(t,s,c){for(var a=c[s]+1||0,o=t[s];a<o.length&&i(t,c,o[a].time)>e;)a+=1;return a===o.length?null:a}function o(t,e,s){var i,c=s||0,o=e||[];if(void 0!==s)for(;o.length>s;)o.pop();for(;c<t.length;)if(i=a(t,c,o),null===i){if(c<o.length&&o.pop(),c-=1,0>c)return null}else o[c]=i,c+=1;return o}function n(t){var e,s,c;for(e=t.length-1;e>0;e-=1)s=Math.floor(Math.random()*(e+1)),c=t[e],t[e]=t[s],t[s]=c;return t}function r(t,e){return e.score-t.score}function d(e){var c,i,a,s=[];for(i=0;e>i;i+=1){for(c={streams:[],timetable:null,score:null},a=0;a<t.length;a+=1)c.streams.push(n(t[a].slice()));if(c.timetable=o(c.streams),c.score=scoreTimetable(c.timetable,c.streams),null===c.timetable)return null;s.push(c)}return s.sort(r)}function l(t){var s,c,e={streams:[],timetable:null,score:null};for(s=0;s<t.streams.length;s+=1)e.streams.push(t.streams[s].slice());for(;null===e.timetable;)c=Math.floor(Math.random()*e.streams.length),n(e.streams[c]),e.timetable=o(e.streams,t.timetable.slice(),c);return e.score=scoreTimetable(e.timetable,e.streams),e}function u(t,e,s,c){if(null===t)return null;s=s||5e3,e=e||20,c=c||5;var i,a,o,n,d=(new Date).getTime(),u=500;for(i=0;s>i;i+=1)if(a=Math.floor(Math.random()*(t.length+c))%t.length,o=t[a],n=l(o),t.push(n),i%10===9){for(t.sort(r);t.length>e;)t.pop();if((new Date).getTime()-d>u){console.warn("search(): max execution time reached after "+i+" iterations");break}}return t.sort(r),t[0]}if(void 0===e&&(e=0),0===t.length)return[];var h=d(50),p=u(h,void 0,s);return null===p?(console.error("No timetables could be generated!"),null):p.timetable.map(function(t,e){return p.streams[e][t]})}
