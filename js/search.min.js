function search(e,t,s){"use strict";function o(e,t){return e[0]!==t[0]?!1:Math.max(0,Math.min(e[2],t[2])-Math.max(e[1],t[1]))}function i(e,t,s){var i,c,n,a,r,l=0;for(i=0;i<s.length;i+=1)for(c=0;c<t.length;c+=1)for(a=e[c][t[c]],r=a.time,n=0;n<r.length;n+=1)l+=o(s[i],r[n]);return l}function c(e,s,o){for(var c=o[s]+1||0,n=e[s];c<n.length&&i(e,o,n[c].time)>t;)c+=1;return c===n.length?null:c}function n(e,t,s){var i,o=s||0,n=t||[];if(void 0!==s)for(;n.length>s;)n.pop();for(;o<e.length;)if(i=c(e,o,n),null===i){if(o<n.length&&n.pop(),o-=1,0>o)return null}else n[o]=i,o+=1;return n}function a(e){var t,s,o;for(t=e.length-1;t>0;t-=1)s=Math.floor(Math.random()*(t+1)),o=e[t],e[t]=e[s],e[s]=o;return e}function r(e,t){return t.score-e.score}function l(t){var o,i,c,s=[];for(i=0;t>i;i+=1){for(o={streams:[],timetable:null,score:null},c=0;c<e.length;c+=1)o.streams.push(a(e[c].slice()));if(o.timetable=n(o.streams),o.score=scoreTimetable(o.timetable,o.streams),null===o.timetable)return null;s.push(o)}return s.sort(r)}function u(e){var s,o,t={streams:[],timetable:null,score:null};for(s=0;s<e.streams.length;s+=1)t.streams.push(e.streams[s].slice());for(;null===t.timetable;)o=Math.floor(Math.random()*t.streams.length),a(t.streams[o]),t.timetable=n(t.streams,e.timetable.slice(),o);return t.score=scoreTimetable(t.timetable,t.streams),t}function d(e,t,s,o){if(null===e)return null;s=s||5e3,t=t||20,o=o||5;var i,c,n,a,l=(new Date).getTime(),d=500;for(i=0;s>i;i+=1)if(c=Math.floor(Math.random()*(e.length+o))%e.length,n=e[c],a=u(n),e.push(a),i%10===9){for(e.sort(r);e.length>t;)e.pop();if((new Date).getTime()-l>d){console.warn("search(): max execution time reached after "+i+" iterations");break}}return e.sort(r),e[0]}if(void 0===t&&(t=0),0===e.length)return[];var h=l(50),f=d(h,void 0,s);return null===f?(console.error("No timetables could be generated!"),null):f.timetable.map(function(e,t){return f.streams[t][e]})}
