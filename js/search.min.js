function search(e,t){"use strict";function r(e,t){return e[0]!==t[0]?!1:Math.max(0,Math.min(e[2],t[2])-Math.max(e[1],t[1]))}function n(e,t,n){var i,l,s,o,a,u=0;for(i=0;i<n.length;i+=1)for(l=0;l<t.length;l+=1)for(o=e[l][t[l]],a=o[0],s=0;s<a.length;s+=1)u+=r(n[i],a[s]);return u}function i(e,r,i){for(var l=i[r]+1||0,s=e[r];l<s.length&&n(e,i,s[l][0])>t;)l+=1;return l===s.length?null:l}function l(e,t,r){var l,n=r||0,s=t||[];if(void 0!==r)for(;s.length>r;)s.pop();for(;n<e.length;)if(l=i(e,n,s),null===l){if(n<s.length&&s.pop(),n-=1,0>n)return null}else s[n]=l,n+=1;return s}function s(e){var t,r,n;for(t=e.length-1;t>0;t-=1)r=Math.floor(Math.random()*(t+1)),n=e[t],e[t]=e[r],e[r]=n;return e}function o(e,t){return t.score-e.score}function a(t){var n,i,a,r=[];for(i=0;t>i;i+=1){for(n={streams:[],timetable:null,score:null},a=0;a<e.length;a+=1)n.streams.push(s(e[a].slice()));if(n.timetable=l(n.streams),n.score=scoreTimetable(n.timetable,n.streams),null===n.timetable)return null;r.push(n)}return r.sort(o)}function u(e){var r,n,t={streams:[],timetable:null,score:null};for(r=0;r<e.streams.length;r+=1)t.streams.push(e.streams[r].slice());for(;null===t.timetable;)n=Math.floor(Math.random()*t.streams.length),s(t.streams[n]),t.timetable=l(t.streams,e.timetable.slice(),n);return t.score=scoreTimetable(t.timetable,t.streams),t}function f(e,t,r,n){if(null===e)return null;r=r||5e3,t=t||20,n=n||5;var i,l,s,a,f=(new Date).getTime(),h=500;for(i=0;r>i;i+=1)if(l=Math.floor(Math.random()*(e.length+n))%e.length,s=e[l],a=u(s),e.push(a),i%10===9){for(e.sort(o);e.length>t;)e.pop();if((new Date).getTime()-f>h){console.warn("search(): max execution time reached after "+i+" iterations");break}}return e[0]}void 0===t&&(t=0);var h=a(10),c=f(h);return null===c?(console.error("No timetables could be generated!"),null):(console.log("Generated timetable with score:",c.score),c.timetable.map(function(e,t){return c.streams[t][e]}))}
