function search(e,t,n){"use strict";function s(e,t){return e[0]!==t[0]?!1:Math.max(0,Math.min(e[2],t[2])-Math.max(e[1],t[1]))}function r(e,t,n){var r,o,i,u,l,c=0;for(r=0;r<n.length;r+=1)for(o=0;o<t.length;o+=1)for(u=e[o][t[o]],l=u.time,i=0;i<l.length;i+=1)c+=s(n[r],l[i]);return c}function o(e,n,s){for(var o=s[n]+1||0,i=e[n];o<i.length&&r(e,s,i[o].time)>t;)o+=1;return o===i.length?null:o}function i(e,t,n){var r,s=n||0,i=t||[];if(void 0!==n)for(;i.length>n;)i.pop();for(;s<e.length;)if(r=o(e,s,i),null===r){if(s<i.length&&i.pop(),s-=1,0>s)return null}else i[s]=r,s+=1;return i}function u(e){var t,n,s;for(t=e.length-1;t>0;t-=1)n=Math.floor(Math.random()*(t+1)),s=e[t],e[t]=e[n],e[n]=s;return e}function l(e,t){return t.score-e.score}function c(t){var s,r,o,n=[];for(r=0;t>r;r+=1){for(s={streams:[],timetable:null,score:null},o=0;o<e.length;o+=1)s.streams.push(u(e[o].slice()));if(s.timetable=i(s.streams),s.score=scoreTimetable(s.timetable,s.streams),null===s.timetable)return null;n.push(s)}return n.sort(l)}function a(e){var n,s,t={streams:[],timetable:null,score:null};for(n=0;n<e.streams.length;n+=1)t.streams.push(e.streams[n].slice());for(;null===t.timetable;)s=Math.floor(Math.random()*t.streams.length),u(t.streams[s]),t.timetable=i(t.streams,e.timetable.slice(),s);return t.score=scoreTimetable(t.timetable,t.streams),t}function f(e,t,n,s){if(null===e)return null;n=n||5e3,t=t||20,s=s||5;var r,o,i,u,c=(new Date).getTime(),f=500;for(r=0;n>r;r+=1)if(o=Math.floor(Math.random()*(e.length+s))%e.length,i=e[o],u=a(i),e.push(u),r%10===9){for(e.sort(l);e.length>t;)e.pop();if((new Date).getTime()-c>f){console.warn("search(): max execution time reached after "+r+" iterations");break}}return e.sort(l),e[0]}void 0===t&&(t=0);var m=c(50),h=f(m,void 0,n);return null===h?(console.error("No timetables could be generated!"),null):h.timetable.map(function(e,t){return h.streams[t][e]})}
