function search(e,t,a,s){"use strict";function n(e,t){return e[0]!==t[0]?!1:e[3]||t[3]?!1:Math.max(0,Math.min(e[2],t[2])-Math.max(e[1],t[1]))}function o(e,t,a){var s,i,o,r,c,l=0;for(s=0;s<a.length;s+=1)for(i=0;i<t.length;i+=1)for(r=e[i][t[i]],c=r.time,o=0;o<c.length;o+=1)l+=n(a[s],c[o]);return l}function r(e,a,i){for(var n=i[a]+1||0,r=e[a];n<r.length&&(o(e,i,r[n].time)>t||"F"===r[n].status&&!s);)n+=1;return n===r.length?null:n}function c(e,t,a){var i,s=a||0,n=t||[];if(void 0!==a)for(;n.length>a;)n.pop();for(;s<e.length;)if(i=r(e,s,n),null===i){if(s<n.length&&n.pop(),s-=1,0>s)return null}else n[s]=i,s+=1;return n}function l(e){var t,a,s;for(t=e.length-1;t>0;t-=1)a=Math.floor(Math.random()*(t+1)),s=e[t],e[t]=e[a],e[a]=s;return e}function d(e){return e.timetable.map(function(t,a){return e.streams[a][t]})}function u(e,t){return t.score-e.score}function m(t){var s,i,n,a=[];for(i=0;t>i;i+=1){for(s={streams:[],timetable:null,score:null},n=0;n<e.length;n+=1)s.streams.push(l(e[n].slice()));if(s.timetable=c(s.streams),s.score=scoreTimetable(s.timetable,s.streams),null===s.timetable)return null;a.push(s)}return a.sort(u)}function f(e){var a,s,t={streams:[],timetable:null,score:null},i=e.streams.length;for(a=0;a<e.streams.length;a+=1)t.streams.push(e.streams[a].slice());var n=1+Math.floor(3.5*Math.random());for(a=0;n>a;a+=1)s=Math.floor(Math.random()*t.streams.length),i=Math.min(i,s),l(t.streams[s]);return t.timetable=c(t.streams,e.timetable.slice(),i),null===t.timetable?t:(t.score=scoreTimetable(t.timetable,t.streams),t)}function h(e,t,a,s){if(null===e)return null;if(0===a)return e[0];a=a||5e3,t=t||40,s=s||5;var i,n,o,r,c=(new Date).getTime(),l=500;for(i=1;a>=i;i+=1)if(n=Math.floor(Math.random()*(e.length+s))%e.length,o=e[n],r=f(o),null!==r.timetable&&(e.push(r),i%10===0)){for(e.sort(u);e.length>t;)e.pop();if((new Date).getTime()-c>l){console.warn("search(): max execution time reached after "+i+" iterations");break}}return e.sort(u),e[0]}if(void 0===t&&(t=0),0===e.length)return[];s=s||!1;var p=a>0?50:1,g=m(p),v=h(g,void 0,a);return null===v?null:d(v)}
