function search(e,t,a,n){"use strict";function s(e,t){return e[0]!==t[0]?!1:e[3]||t[3]?!1:Math.max(0,Math.min(e[2],t[2])-Math.max(e[1],t[1]))}function i(e,t,a){var n,o,i,r,l,c=0;for(n=0;n<a.length;n+=1)for(o=0;o<t.length;o+=1)for(r=e[o][t[o]],l=r.time,i=0;i<l.length;i+=1)c+=s(a[n],l[i]);return c}function r(e,a,o){for(var s=o[a]+1||0,r=e[a];s<r.length&&(i(e,o,r[s].time)>t||"F"===r[s].status&&!n);)s+=1;return s===r.length?null:s}function l(e,t,a){var o,n=a||0,s=t||[];if(void 0!==a)for(;s.length>a;)s.pop();for(;n<e.length;)if(o=r(e,n,s),null===o){if(n<s.length&&s.pop(),n-=1,0>n)return null}else s[n]=o,n+=1;return s}function c(e){var t,a,n;for(t=e.length-1;t>0;t-=1)a=Math.floor(Math.random()*(t+1)),n=e[t],e[t]=e[a],e[a]=n;return e}function d(e){return e.timetable.map(function(t,a){return e.streams[a][t]})}function u(e,t){return t.score-e.score}function m(t){var n,o,s,a=[];for(o=0;t>o;o+=1){for(n={streams:[],timetable:null,score:null},s=0;s<e.length;s+=1)n.streams.push(c(e[s].slice()));if(n.timetable=l(n.streams),n.score=scoreTimetable(n.timetable,n.streams),null===n.timetable)return null;a.push(n)}return a.sort(u)}function f(e){var a,n,t={streams:[],timetable:null,score:null},o=e.streams.length;for(a=0;a<e.streams.length;a+=1)t.streams.push(e.streams[a].slice());var s=1+Math.floor(3.5*Math.random());for(a=0;s>a;a+=1)n=Math.floor(Math.random()*t.streams.length),o=Math.min(o,n),c(t.streams[n]);return t.timetable=l(t.streams,e.timetable.slice(),o),null===t.timetable?t:(t.score=scoreTimetable(t.timetable,t.streams),t)}function h(e,t,a,n){if(null===e)return null;if(0===a)return e[0];a=a||5e3,t=t||40,n=n||5;var o,s,i,r,l=(new Date).getTime(),c=500;for(o=1;a>=o;o+=1)if(s=Math.floor(Math.random()*(e.length+n))%e.length,i=e[s],r=f(i),null!==r.timetable&&(e.push(r),o%10===0)){for(e.sort(u);e.length>t;)e.pop();if((new Date).getTime()-l>c){console.warn("search(): max execution time reached after "+o+" iterations");break}}return e.sort(u),console.log("Found timetable with score",e[0].score,"in",(new Date).getTime()-l,"ms"),e[0]}if(void 0===t&&(t=0),0===e.length)return[];n=n||!1;var p=a>0?50:1,g=m(p),v=h(g,void 0,a);return null===v?null:d(v)}
