function fetchData(e){"use strict";var n="courses="+encodeURI(JSON.stringify(courseList)),r=[];$.getJSON("data.php",n,function(n){function i(e,n){function u(e,n){var t=e[0].replace(/[^\d\-,.]/g,"").split(/[,\-]/).map(function(e){return Math.ceil(+e)}),i=n[0].replace(/[^\d\-,.]/g,"").split(/[,\-]/).map(function(e){return Math.ceil(+e)}),l=function(e){return r.indexOf(e)},o=Math.max.apply(null,t.map(l)),a=Math.max.apply(null,i.map(l));return o-a}function s(e,n){var r=e[0].replace(/[\d\- ]/g,"").split(","),i=n[0].replace(/[\d\- ]/g,"").split(","),l=function(e){return t.indexOf(e)},o=Math.max.apply(null,r.map(l)),a=Math.max.apply(null,i.map(l));return o-a}function c(e,n){return e[1]===n[1]?0:"O"===e[1]?-1:1}var a,f,r=[12,13,14,11,15,16,10,17,18,19,20,9,21,22,23,8,7,6,5,4,3,2,1,0],t=["M","T","H","F","W","S","s"];for(a=0,f=[c,u,s];0===a&&(a=f.shift()(e,n),0!==f.length););return a}var t={};!function(){var e,r,i,l,o,a,f;for(e in n)if(n.hasOwnProperty(e)&&(t[e]={},r=n[e],null!==r))for(a=0;a<r.length;a+=1){for(i=r[a],l=i[3],o=[],f=0;f<l.length;f+=1)o.push(l[f][0]);o=o.join(","),t[e].hasOwnProperty(i[0])||(t[e][i[0]]=[]),0!==o.length&&t[e][i[0]].push([o,i[1],i[2],e,i[0]])}}(),t.CBS={},$("#tbt").is(":checked")&&(t.CBS.TBT=[["T 12","O","0,1","CBS","The Bible Talks"],["T 13","O","0,1","CBS","The Bible Talks"],["H 12","O","0,1","CBS","The Bible Talks"],["H 13","O","0,1","CBS","The Bible Talks"]]),$("#cth").is(":checked")&&(t.CBS.CoreTheo=[["T 17","O","0,1","CBS","Core Theology"],["W 13","O","0,1","CBS","Core Theology"]]),$("#ctr").is(":checked")&&(t.CBS.CoreTrain=[["T 16","O","0,1","CBS","Core Training"],["T 18","O","0,1","CBS","Core Training"],["W 12","O","0,1","CBS","Core Training"],["W 14","O","0,1","CBS","Core Training"]]),$("#bib").is(":checked")&&(t.CBS.BibleStudy=[["M 11","O","0,1","CBS","Bible Study"],["M 12","O","0,1","CBS","Bible Study"],["M 13","O","0,1","CBS","Bible Study"],["M 14","O","0,1","CBS","Bible Study"],["T 11","O","0,1","CBS","Bible Study"],["T 14","O","0,1","CBS","Bible Study"],["W 11","O","0,1","CBS","Bible Study"],["H 11","O","0,1","CBS","Bible Study"],["H 14","O","0,1","CBS","Bible Study"]]),function(){var e,n;for(e in t)if(t.hasOwnProperty(e))for(n in t[e])t[e].hasOwnProperty(n)&&r.push([t[e][n].sort(i),t[e][n].length]);r.sort(function(e,n){return e[1]-n[1]}),r=r.map(function(e){return e[0]}),r=r.map(function(e){return e.map(function(e){var n=e[0].split(","),r=n.map(function(e){var n=e.replace(/[^\d\-.]/g,"").split("-");return 1===n.length&&(n[1]=+n[0]+1),[e[0],+n[0],+n[1]]});return e[0]=r,e})})}(),e(r)})}function generate(){"use strict";function e(e){var n={M:120,T:100,W:180,H:100,F:150},r={M:!1,T:!1,W:!1,H:!1,F:!1},t=-20,i=-20,l=-40,o=100,a=75,f=100,s=0;return function(){var l,t=e.map(function(e){return e[0][0]}),i=t.join("");for(l in n)n.hasOwnProperty(l)&&-1===i.indexOf(l)&&(s+=n[l],r[l]=!0);return s}(),function(){var n,r;for(r=0;r<e.length;r+=1)n=e[r][0],n[1]<10&&(s+=t),n[2]>=17&&(s+=i),n[2]>=20&&(s+=l);return s}(),function(){var n,t,i,l,u;for(n=0;n<e.length;n+=1)"The Bible Talks"===e[n][4]&&(t=e[n][0][0]),"Core Theology"===e[n][4]&&(i=e[n][0][0]),"Core Training"===e[n][4]&&(l=e[n][0][0]),"Bible Study"===e[n][4]&&(u=e[n][0][0]);t&&(s+=(1+!r[t])*o),i&&(s+=(1+!r[i])*a),l&&(s+=(1+!r[l])*a),u&&(s+=(1+!r[u])*f)}(),s}function n(e){var n,r,t;for(n=e.length-1;n>0;n-=1)r=Math.floor(Math.random()*(n+1)),t=e[n],e[n]=e[r],e[r]=t;return e}fetchData(function(r){function t(e,n){return e[0]!==n[0]?!1:e[1]>=n[2]||n[1]>=e[2]?!1:!0}function i(e,n,r){var i,l,o,a,f;for(i=0;i<r.length;i+=1)for(l=0;l<n.length;l+=1)for(a=e[l][n[l]],f=a[0],o=0;o<f.length;o+=1)if(t(r[i],f[o]))return!0;return!1}function l(e){for(var t,l,n=[],r=0;r<e.length;){for(t=e[r],l=n[r]+1||0;l<t.length&&i(e,n,t[l][0]);)l+=1;if(l===t.length){if(n[r]=0,n.pop(),r-=1,0>r)return null}else n[r]=l,r+=1}return n.map(function(n,r){return e[r][n]})}function o(t){t=void 0!==t?t:1e3;var i,o,f,u,s,a={score:-(1/0),timetable:[]};for(i=0;t>i;i+=1){for(s=r.slice(),o=0;o<s.length;o+=1)n(s[o]);if(f=l(s),null===f){0===i&&console.error("Could not generate timetable! Some clashes could not be resolved.");break}u=e(f),u>a.score&&(a.score=u,a.timetable=f)}return console.log("Generated timetable with score",a.score),a.timetable}var f,u,s,c,h,a=o();for(f=0;f<classList.length;f+=1)classList[f].remove();for($(".class-shadow").remove(),clearLists(),c=[],f=0;f<a.length;f+=1)s=a[f],h=courseList.indexOf(s[3]),createClass(s[0],s[3],s[4],h,c);for(c=[],f=0;f<r.length;f+=1)for(u=0;u<r[f].length;u+=1)h=courseList.indexOf(r[f][u][3]),createShadow(r[f][u][0],r[f][u][3]+r[f][u][4],h,c)})}
