function scoreTime(e,r){"use strict";var t=4-Math.abs(14.5-(e+r)/2);return t*=Math.abs(t),t*=r-e}function evaluateTimetable(e){"use strict";var t,i,n,l,o,r=0,f={M:!1,T:!1,W:!1,H:!1,F:!1},s={M:!1,T:!1,W:!1,H:!1,F:!1},a=[],h={M:120,T:100,W:180,H:100,F:150},c=150,B=100,S=150;for(t=0;t<e.length;t+=1){for(n=e[t][0],i=0;i<n.length;i+=1)l=n[i],"CBS"===e[t][3]?(f[l[0]]=!0,a.push(l)):s[l[0]]=!0,r+=scoreTime(l[1],l[2]);"The Bible Talks"===e[t][4]?r+=c:"Core Theology"===e[t][4]||"Core Training"===e[t][4]?r+=B:"Bible Study"===e[t][4]&&(r+=S)}for(o in s)s.hasOwnProperty(o)&&s[o]===!1&&f[o]===!1&&(r+=h[o]);return r}function fetchData(e){"use strict";var r="courses="+encodeURI(JSON.stringify(courseList)),t=[];$.getJSON("data.php",r,function(r){var i={};!function(){var e,t,n,l,f,s,a;for(e in r)if(r.hasOwnProperty(e)&&(i[e]={},t=r[e],null!==t))for(s=0;s<t.length;s+=1){for(n=t[s],l=n[3],f=[],a=0;a<l.length;a+=1)f.push(l[a][0]);f=f.join(","),i[e].hasOwnProperty(n[0])||(i[e][n[0]]=[]),0!==f.length&&i[e][n[0]].push([f,n[1],n[2],e,n[0]])}}(),i.CBS={},$("#tbt").is(":checked")&&(i.CBS.TBT=[["T 12","O","0,1","CBS","The Bible Talks"],["T 13","O","0,1","CBS","The Bible Talks"],["H 12","O","0,1","CBS","The Bible Talks"],["H 13","O","0,1","CBS","The Bible Talks"]]),$("#cth").is(":checked")&&(i.CBS.CoreTheo=[["T 17","O","0,1","CBS","Core Theology"],["W 13","O","0,1","CBS","Core Theology"]]),$("#ctr").is(":checked")&&(i.CBS.CoreTrain=[["T 16","O","0,1","CBS","Core Training"],["T 18","O","0,1","CBS","Core Training"],["W 12","O","0,1","CBS","Core Training"],["W 14","O","0,1","CBS","Core Training"]]),$("#bib").is(":checked")&&(i.CBS.BibleStudy=[["M 11","O","0,1","CBS","Bible Study"],["M 12","O","0,1","CBS","Bible Study"],["M 13","O","0,1","CBS","Bible Study"],["M 14","O","0,1","CBS","Bible Study"],["T 11","O","0,1","CBS","Bible Study"],["T 14","O","0,1","CBS","Bible Study"],["W 11","O","0,1","CBS","Bible Study"],["H 11","O","0,1","CBS","Bible Study"],["H 14","O","0,1","CBS","Bible Study"]]),function(){var e,r;for(e in i)if(i.hasOwnProperty(e))for(r in i[e])i[e].hasOwnProperty(r)&&t.push([i[e][r],i[e][r].length]);t.sort(function(e,r){return e[1]-r[1]}),t=t.map(function(e){return e[0]}),t=t.map(function(e){return e.map(function(e){var r=e[0].split(","),t=r.map(function(e){var r=e.replace(/[^\d\-.]/g,"").split("-");return 1===r.length&&(r[1]=+r[0]+1),[e[0],+r[0],+r[1]]});return e[0]=t,e})})}(),function(){var e,r,i,n,l,f,s;for(r=0;r<t.length;r+=1){for(n=t[r],e={},i=0;i<n.length;i+=1)l=n[i],f=l[0],e.hasOwnProperty(f)?(s=e[f],"O"===l[1]&&"O"!==s[1]?e[l[0]]=l:l[2].split(",")[0]>s[2].split(",")[0]&&(e[l[0]]=l)):e[l[0]]=l;t[r]=[];for(f in e)e.hasOwnProperty(f)&&t[r].push(e[f])}}(),e(t)})}function generate(){"use strict";fetchData(function(e){function r(e,r){return e[0]!==r[0]?!1:e[1]>=r[2]||r[1]>=e[2]?!1:!0}function t(e,t,i){var n,l,f,s,a;for(n=0;n<i.length;n+=1)for(l=0;l<t.length;l+=1)for(s=e[l][t[l]],a=s[0],f=0;f<a.length;f+=1)if(r(i[n],a[f]))return!0;return!1}function i(e,r){function c(){return s<i.length&&i.pop(),s-=1,0>s?(null===f.timetable&&(console.error("No timetable could be generated"),console.error("Try again with more clash hours")),!1):!0}function B(){return i.map(function(r,t){return e[t][r]})}for(var n,l,a,o,u,i=[],f={timetable:null,score:null},s=0;s<e.length;){for(a=e[s],o=i[s]||0;o<a.length&&(u=a[o][0],t(e,i,u));)o+=1;if(o<a.length)i[s]=o,s+=1,s===e.length&&(n=B(),l=evaluateTimetable(n),l>f.score&&(f.timetable=n,f.score=l),c());else if(!c())break}return f.timetable}var l,f,s,a,o,n=i(e,0);for(l=0;l<classList.length;l+=1)classList[l].remove();for($(".class-shadow").remove(),clearLists(),a=[],l=0;l<n.length;l+=1)s=n[l],o=courseList.indexOf(s[3]),createClass(s[0],s[3],s[4],o,a);for(a={},l=0;l<e.length;l+=1)for(f=0;f<e[l].length;f+=1)o=courseList.indexOf(e[l][f][3]),createShadow(e[l][f][0],e[l][f][3]+e[l][f][4],o,a)})}
