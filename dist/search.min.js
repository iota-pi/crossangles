function search(e,t,i,s){"use strict";function o(e,t){return e[0]!==t[0]?!1:e[3]||t[3]?!1:Math.max(0,Math.min(e[2],t[2])-Math.max(e[1],t[1]))}function a(e,t,i){var s,n,a,r,c,l=0;for(s=0;s<i.length;s+=1)for(n=0;n<t.length;n+=1)for(r=e[n][t[n]],c=r.time,a=0;a<c.length;a+=1)l+=o(i[s],c[a]);return l}function r(e,i,n){for(var o=n[i]+1||0,r=e[i];o<r.length&&(a(e,n,r[o].time)>t||"F"===r[o].status&&!s);)o+=1;return o===r.length?null:o}function c(e,t,i){var n,s=i||0,o=t||[];if(void 0!==i)for(;o.length>i;)o.pop();for(;s<e.length;)if(n=r(e,s,o),null===n){if(s<o.length&&o.pop(),s-=1,0>s)return null}else o[s]=n,s+=1;return o}function l(e){var t,i,s;for(t=e.length-1;t>0;t-=1)i=Math.floor(Math.random()*(t+1)),s=e[t],e[t]=e[i],e[i]=s;return e}function u(e){return e.timetable.map(function(t,i){return e.streams[i][t]})}function d(e,t){return t.score-e.score}function f(t){var s,n,o,i=[];for(n=0;t>n;n+=1){for(s={streams:[],timetable:null,score:null},o=0;o<e.length;o+=1)s.streams.push(l(e[o].slice()));if(s.timetable=c(s.streams),s.score=scoreTimetable(s.timetable,s.streams),null===s.timetable)return null;i.push(s)}return i.sort(d)}function h(e){var i,s,t={streams:[],timetable:null,score:null},n=e.streams.length;for(i=0;i<e.streams.length;i+=1)t.streams.push(e.streams[i].slice());var o=1+Math.floor(3.5*Math.random());for(i=0;o>i;i+=1)s=Math.floor(Math.random()*t.streams.length),n=Math.min(n,s),l(t.streams[s]);return t.timetable=c(t.streams,e.timetable.slice(),n),null===t.timetable?t:(t.score=scoreTimetable(t.timetable,t.streams),t)}function m(e,t,i,s){if(null===e)return null;if(0===i)return e[0];i=i||5e3,t=t||40,s=s||5;var n,o,a,r,c=(new Date).getTime(),l=500;for(n=1;i>=n;n+=1)if(o=Math.floor(Math.random()*(e.length+s))%e.length,a=e[o],r=h(a),null!==r.timetable&&(e.push(r),n%10===0)){for(e.sort(d);e.length>t;)e.pop();if((new Date).getTime()-c>l){console.warn("search(): max execution time reached after "+n+" iterations");break}}return e.sort(d),e[0]}if(void 0===t&&(t=0),0===e.length)return[];s=s||!1;var p=i>0?50:1,g=f(p),v=m(g,void 0,i);return null===v?null:u(v)}
